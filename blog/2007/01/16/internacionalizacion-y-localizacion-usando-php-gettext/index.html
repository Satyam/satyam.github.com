<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>
      Comentarios » Internacionalización y localización: usando PHP-gettext
    </title>
    <meta name="generator" content="WordPress 5.1.1" />
    <link
      type="text/css"
      media="screen"
      rel="stylesheet"
      href="http://www.satyam.com.ar/blog/wp-content/themes/connections/style.css "
    />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="RSS 2.0"
      href="http://www.satyam.com.ar/blog/feed/"
    />
    <link
      rel="alternate"
      type="application/atom+xml"
      title="Atom 0.3"
      href="http://www.satyam.com.ar/blog/feed/atom/"
    />

    <link
      rel="alternate"
      type="application/rss+xml"
      title="Comentarios » Internacionalización y localización: usando PHP-gettext RSS de los comentarios"
      href="http://www.satyam.com.ar/blog/2007/01/16/internacionalizacion-y-localizacion-usando-php-gettext/feed/"
    />

    <style type="text/css">
      img.wp-smiley,
      img.emoji {
        display: inline !important;
        border: none !important;
        box-shadow: none !important;
        height: 1em !important;
        width: 1em !important;
        margin: 0 0.07em !important;
        vertical-align: -0.1em !important;
        background: none !important;
        padding: 0 !important;
      }
    </style>
    <link
      rel="stylesheet"
      id="wp-block-library-css"
      href="http://www.satyam.com.ar/blog/wp-includes/css/dist/block-library/style.min.css?ver=845e834b3fc80791b38e8f084768285d"
      type="text/css"
      media="all"
    />

    <link
      rel="wlwmanifest"
      type="application/wlwmanifest+xml"
      href="http://www.satyam.com.ar/blog/wp-includes/wlwmanifest.xml"
    />
    <link
      rel="prev"
      title="Internacionalización y localización: usando gettext()"
      href="http://www.satyam.com.ar/blog/2007/01/16/internacionalizacion-y-localizacion-usando-gettext/"
    />
    <link
      rel="next"
      title="Internacionalización y localización: índice"
      href="http://www.satyam.com.ar/blog/2007/01/17/internacionalizacion-y-localizacion-indice/"
    />

    <link
      rel="canonical"
      href="http://www.satyam.com.ar/blog/2007/01/16/internacionalizacion-y-localizacion-usando-php-gettext/"
    />
  </head>
  <body>
    <div id="rap">
      <div id="header">
        <ul id="topnav">
          <li>
            <a
              href="http://www.satyam.com.ar/blog"
              id="navHome"
              title="Posted Recently"
              accesskey="h"
              >Home |</a
            >
          </li>

          <li>
            <a
              href="http://www.satyam.com.ar/blog/gallery"
              id="navGallery"
              title="Photo Gallery"
              accesskey="g"
              >Fotos |</a
            >
          </li>
          <li><a href="#Buscar" title="Buscar" accesskey="b">Buscar</a></li>
          <!--li><a href="#" id="navContact" title="Contact the Author" accesskey="c">Contact </a></li-->
        </ul>
        <h1>
          <a href="http://www.satyam.com.ar/blog" title="Comentarios"
            >Comentarios</a
          >
        </h1>
        <div id="desc">Comentarios, viajes e historias</div>
      </div>
      <div id="main">
        <div id="content">
          <div class="post">
            <table>
              <tbody>
                <tr>
                  <td>
                    <p class="post-date">mar 16 Ene 2007</p>
                  </td>
                  <td>
                    <div class="post-info">
                      <h2 class="post-title">
                        <a
                          href="http://www.satyam.com.ar/blog/2007/01/16/internacionalizacion-y-localizacion-usando-php-gettext/"
                          rel="bookmark"
                          title="Permanent Link: Internacionalización y localización: usando PHP-gettext"
                          >Internacionalización y localización: usando
                          PHP-gettext</a
                        >
                      </h2>
                      Posted by Satyam under
                      <a
                        href="http://www.satyam.com.ar/blog/category/tecnologia/programacion/"
                        rel="category tag"
                        >Programación</a
                      >
                      <br />
                      <a
                        href="http://www.satyam.com.ar/blog/2007/01/16/internacionalizacion-y-localizacion-usando-php-gettext/#comments"
                        >[8] Comments</a
                      > 
                    </div>
                  </td>
                  <td></td>
                </tr>
              </tbody>
            </table>
            <div class="post-content">
              <p>
                Dados los problemas de uso de la biblioteca de funciones
                <a
                  title="Manual de PHP: funciones de gettext"
                  target="phpmanual"
                  href="http://es2.php.net/manual/es/ref.gettext.php"
                  ><code>gettext()</code></a
                >
                incorporadas dentro mismo de PHP mencionadas en el artículo
                anterior, mi sugerencia es usar
                <a
                  title="PHP-gettext"
                  target="_blank"
                  href="http://savannah.nongnu.org/projects/php-gettext/"
                  >PHP-gettext</a
                >, un paquete que usan muchas aplicaciones, incluso WordPress,
                en que corre este blog. No sólo su uso es más simple sino que
                tiene un <code>README</code> donde explica rápidamente su uso,
                dispone de ejemplos e incluye un archivo para hacer una
                emulación completa de la funcionalidad de la biblioteca
                <code>gettext()</code>, aunque vistos los problemas comentados,
                lo que menos puedo recomendar es usar una emulación que los
                reproduce hasta el último dolor de cabeza.<span
                  id="more-67"
                ></span>
              </p>
              <p>
                Usar este paquete requiere, básicamente, incluir un par de
                archivos que se proveen, como se ve en el ejemplo:
              </p>
              <p>
                <code
                  ><span style="color: #007700">include </span
                  ><span style="color: #dd0000"
                    >'php-gettext-1.0.7/streams.php'</span
                  ></code
                ><code
                  ><span style="color: #007700"
                    >;<br />
                    include </span
                  ><span style="color: #dd0000"
                    >'php-gettext-1.0.7/gettext.php'</span
                  ><span style="color: #007700">;</span></code
                >
              </p>
              <p>
                La razón de dividir el paquete en dos archivos es que el segundo
                es el que provee la funcionalidad de
                <code>gettext</code> mientras que el primero es el que lee el
                archivo de traducciones y puede ser reemplazado por otro que
                acceda a este archivo por otro mecanismo.
              </p>
              <p>
                La carga del archivo de traducciones en sí se hace mediante el
                siguiente código:
              </p>
              <p>
                <code
                  ><font color="#007700">if (</font
                  ><span style="color: #0000bb">file_exists</span
                  ><span style="color: #007700">(</span
                  ><span style="color: #0000bb">$_SESSION</span
                  ><span style="color: #007700">[</span
                  ><span style="color: #dd0000">'language'</span
                  ><span style="color: #007700">] . </span
                  ><span style="color: #dd0000">'.mo'</span></code
                ><code
                  ><span style="color: #007700">)) {<br /> </span
                  ><span style="color: #0000bb"> $gettext_tables </span
                  ><span style="color: #007700">= new </span
                  ><span style="color: #0000bb">gettext_reader</span
                  ><span style="color: #007700"
                    >(<br />
                    new </span
                  ><span style="color: #0000bb">CachedFileReader</span
                  ><span style="color: #007700">(</span
                  ><span style="color: #0000bb">$_SESSION</span
                  ><span style="color: #007700">[</span
                  ><span style="color: #dd0000">'language'</span
                  ><span style="color: #007700">] . </span
                  ><span style="color: #dd0000">'.mo'</span></code
                ><code
                  ><span style="color: #007700"
                    >)<br />
                    );<br /> </span
                  ><span style="color: #0000bb"> $gettext_tables</span
                  ><span style="color: #007700">-></span
                  ><span style="color: #0000bb">load_tables</span></code
                ><span style="color: #007700"
                  ><code
                    >();<br />
                    }</code
                  ></span
                >
              </p>
              <p>
                Como se puede ver, el archivo de traducciones se puede ubicar
                donde uno prefiera, el control es total. En este caso, primero
                verifico que exista y luego genero una instancia del
                <code>CachedFileReader</code> indicándole la ubicación del
                archivo. A su vez, este objeto se usa en el constructor de
                <code>gettext_reader</code>, que es el objeto que proveerá toda
                la funcionalidad de <code>gettext</code>. Finalmente, se invoca
                el método que carga las tablas. El paquete permite tanto cachear
                las tablas en memoria (predeterminado) o accederlas directamente
                a disco, en cuyo caso el <code>FileReader</code> almacena los
                punteros a las traducciones accediéndolas directamente del
                archivo. Esto se determina mediante un argumento opcional en el
                lector o instanciando distintos lectores.
              </p>
              <p>
                La idea de usar el nombre <code>_()</code> para la función de
                traducción es muy bueno, pero como ya está tomado y no es
                posible redefinirlo, usamos <code>__()</code>, que es igualmente
                breve y legible, donde la legibilidad está en la facilidad de
                leer los textos a traducir, pues a la parte ejecutable no le
                afecta.
              </p>
              <pre><span style="color: #007700">function </span><span style="color: #0000bb">__</span><span style="color: #007700">(</span><span style="color: #0000bb">$texto</span><span style="color: #007700">) {
global </span><span style="color: #0000bb">$gettext_tables</span><span style="color: #007700">;</span><span style="color: #007700">

if (</span><span style="color: #0000bb">is_null</span><span style="color: #007700">(</span><span style="color: #0000bb">$gettext_tables</span><span style="color: #007700">)) return </span><span style="color: #0000bb">$texto</span><span style="color: #007700">;
else return </span><span style="color: #0000bb">$gettext_tables</span><span style="color: #007700">-></span><span style="color: #0000bb">translate</span><span style="color: #007700">(</span><span style="color: #0000bb">$texto</span><span style="color: #007700">);
}</span></pre>
              <p>
                Esta función verifica que el objeto haya sido instanciado con
                éxito y si es así, llama al método . En cualquier caso, ya fuera
                que la traducción no existiera, un texto individual o el archivo
                de traducciones completo, la función devuelve el texto original
                con lo que, al menos, el usuario no se queda mirando una
                pantalla en blanco.A partir de allí, el resto del programa es
                simple, cada vez que se quiere usar una cadena localizable, se
                la encierra en una llamada a la función y listo.Probablemente ya
                hayan notado que no es necesario inventar identificadores para
                las cadenas a traducir, el texto en el idioma original es la
                clave de búsqueda por lo que en el caso de no haber una
                traducción, siempre se dispone de algún texto, aunque fuera en
                un idioma que no corresponde al pedido por el usuario.
              </p>
              <p>
                A todo esto, no hemos aclarado cómo se genera un archivo
                <code>.mo</code>, ni hemos explicado la estructura del archivo
                de traducciones.
              </p>
              <p>
                La clave del uso del paquete <code>gettext</code> es una serie
                de programas que se encargan de rastrear los fuentes buscando
                cadenas a traducir y actualizarlas cuando cambian. Existen
                programas con interfaces gráficas para facilitar esta tarea, tal
                como
                <a title="poEdit" target="_blank" href="http://www.poedit.net/"
                  >poEdit</a
                >, que está disponible para Linux, Macintosh y Windows y,
                obviamente, internacionalizado, aunque también están los
                comandos de línea que existen en todas las plataformas Linux
                (aunque pueden no estar instalados por defecto) y también hay
                versiones para Windows (<a
                  title="gnuwin32 en SourceForge"
                  target="_blank"
                  href="http://gnuwin32.sourceforge.net/packages/gettext.htm"
                  >gnuwin32</a
                >).
              </p>
              <p>El proceso, resumido, es el siguiente:</p>
              <p>
                1) se extraen las cadenas a traducir con el programa
                <code>xgettext</code>:
              </p>
              <p>
                <code
                  >xgettext *.php --output=index.pot --keyword=__
                  --from-code=ISO-8859-1</code
                >
              </p>
              <p>
                En todos los casos he usado las versiones largas de las opciones
                para que sean más claras. A <code>xgettext</code> se le indica
                el o los fuentes de los que extraer las cadenas. Se le debe
                indicar el archivo de salida o redireccionar de la salida
                estándar, el set de caracteres de los fuentes y, en nuestro
                caso, dado que hemos usado el nombre de función
                <code>__()</code> en lugar de <code>_()</code> se le debe
                indicar expresamente que busque este nombre de función. El
                programa reconoce el lenguaje de los fuentes por su extensión e
                interpreta la sintáxis según se trate, pero si se hubiera usado
                alguna extensión que no reconociera, se le puede indicar
                expresamente.
              </p>
              <p>
                En este caso la salida ha sido un archivo <code>.pot</code>,
                extensión que corresponde a un <em>‘template’</em> o ‘modelo’ de
                la traducción. Es habitual entregar este archivo de modelo como
                parte de una aplicación para que el traductor disponga de un
                original limpio a partir del cual comenzar su trabajo.
              </p>
              <p>2) Se genera un archivo de traducción a partir del modelo:</p>
              <p>
                <code
                  >msginit --input=index.pot --output=en.po --locale=en</code
                >
              </p>
              <p>
                Este programa simplemente toma el archivo <code>.pot</code> que
                se le indica y genera un archivo <code>.po</code> para la
                localización que se indica. Completa varios de los campos con
                datos que obtiene del sistema, por ejemplo, el nombre de
                usuario, la fecha de la traducción y pone como traducción el
                mismo texto que el original. El traductor puede tanto comenzar a
                partir del archivo <code>.pot</code> o del
                <code>.po</code> según prefiera.
              </p>
              <p>
                3) Traducción. Esta se puede hacer con cualquier editor de texto
                simple. Existen macros para EMACS y hay IDEs que tienen modos de
                edición específicos para este tipo de archivo. Aplicaciones como
                <a title="poEdit" target="_blank" href="http://www.poedit.net/"
                  >poEdit</a
                >
                disponen de su propio editor. Este programa en particular
                permite guardar una base de datos de traducciones de tal manera
                que en sucesivas traducciones puede intentar por sí solo
                traducir parte de los textos.
              </p>
              <p>
                De todas formas, el proceso es simple, el texto tras la palabra
                clave msgid es el original, el que sigue a msgstr es la
                traducción. Para facilitar la tarea, los comentarios que
                preceden a cada cadena muestran el fuente y número de línea en
                que ha encontrado esta cadena. El programa
                <code>xgettext</code> se encarga de identificar cadenas
                duplicadas por sí mismo.
              </p>
              <p>4) Compilación:</p>
              <p><code>msgfmt en.po --output-file=en.mo</code></p>
              <p>
                Esta es la parte más simple del proceso, compilarlo implica
                llamar a <code>msgfmt</code>, indicarle el nombre del archivo de
                entrada y el de salida.
              </p>
              <p>
                Esta última etapa puede automatizarse fácilmente dentro de un
                archivo <code>makefile</code>, no así las primeras. En
                particular, llamar a <code>msginit</code> una segunda vez
                destruiría el archivo de traducciones ya hecho. El paquete
                dispone de un mecanismo de actualización a través del programa
                <code>msgmerge</code>. El proceso de actualización es similar al
                ya descripto, comenzando por el punto 1 hasta el 4, excepto que
                en lugar del paso 2 anterior se utiliza el comando siguiente:
              </p>
              <p><code>msgmerge --update en.po index.pot</code></p>
              <p>
                El comando <code>msgmerge</code> lee tanto el
                <code>.pot</code> como el <code>.po</code> y actualiza este
                último sin dañar las traducciones ya presentes.
              </p>
              <p>
                Adviértase que solo es necesario un único archivo de
                traducciones para toda una aplicación, no es necesaria un
                archivo asociado a cada fuente, de allí que para el modelo usé
                el nombre <code>index.pot</code>, adoptando index como
                predeterminado, aunque no esto no es necesario.
              </p>
              <p>
                Gettext tiene varias otras facilidades que no he mencionado,
                como ser el manejo de traducciones ambiguas (<em>fuzzy</em>),
                plurales (permite ofrecer distintas traducciones según el número
                de ítems que se le indiquen) y múltiples dominios, lo cual es
                indispensable cuando se utilizan paquetes de diferentes orígenes
                o <em>‘plugins’</em>, cada uno con sus conjunto de traducciones
                independientes. Para esto se recomienda ver la documentación
                original.
              </p>
              <p>
                Viene de:
                <a
                  title="Enlace permanente: Internacionalización y localización: usando gettext()"
                  rel="bookmark"
                  href="http://www.satyam.com.ar/blog/2007/01/16/internacionalizacion-y-localizacion-usando-gettext/"
                  >Internacionalización y localización: usando gettext()</a
                >
              </p>
              <p>
                Continúa en:
                <a
                  title="Enlace permanente: Internacionalización y localización: bases de datos"
                  rel="bookmark"
                  href="http://www.satyam.com.ar/blog/2007/01/17/internacionalizacion-y-localizacion-bases-de-datos/"
                  >Internacionalización y localización: bases de datos</a
                >
              </p>
              <p>
                Indice:
                <a
                  title="Enlace permanente: Internacionalización y Localización: índice"
                  rel="bookmark"
                  href="http://www.satyam.com.ar/blog/2007/01/17/internacionalizacion-y-localizacion-indice/"
                  >Internacionalización y Localización: índice</a
                >
              </p>
              <p><!--2f464a23d485efabb75aa5b7753bbb3b--></p>
              <p><!--3e19431f570a5fb0e5f99ff7d93d461b--></p>
              <div class="post-info"></div>
              <div class="post-footer"> </div>
            </div>
            <!-- You can start editing here. -->

            <h3 id="comments">
              8 Responses to “Internacionalización y localización: usando
              PHP-gettext”
            </h3>

            <ol class="commentlist">
              <li class="alt" id="comment-4412">
                <cite
                  ><a href="http://aurea.es" rel="external nofollow" class="url"
                    >Quasi</a
                  ></cite
                >
                Says:
                <br />

                <small class="commentmetadata"
                  ><a href="#comment-4412" title=""
                    >agosto 8th, 2007 at 21:56</a
                  >
                </small>

                <p>Realmente increible.</p>
                <p>
                  El tutorial que has hecho sobre internacionalizaci�n es
                  sencillamente magnifico.
                </p>
                <p>Gracias por tu labor y Felicidades por el resultado.</p>
                <p>😉</p>
              </li>

              <li class="" id="comment-15653">
                <cite>Ana</cite> Says:
                <br />

                <small class="commentmetadata"
                  ><a href="#comment-15653" title=""
                    >abril 22nd, 2008 at 19:46</a
                  >
                </small>

                <p>Muchas gracias por tus explicaciones, :-))</p>
              </li>

              <li class="alt" id="comment-16140">
                <cite
                  ><a
                    href="http://www.javierav.com"
                    rel="external nofollow"
                    class="url"
                    >Javier</a
                  ></cite
                >
                Says:
                <br />

                <small class="commentmetadata"
                  ><a href="#comment-16140" title="">mayo 2nd, 2008 at 1:14</a>
                </small>

                <p>Hola.</p>
                <p>
                  Gracias por este mini tutorial, me ha quedado todo mucho m�s
                  claro.
                </p>
                <p>Saludos.</p>
              </li>

              <li class="" id="comment-20960">
                <cite>radt</cite> Says:
                <br />

                <small class="commentmetadata"
                  ><a href="#comment-20960" title=""
                    >agosto 8th, 2008 at 11:46</a
                  >
                </small>

                <p>Hola,</p>
                <p>
                  Por alguna razon que no podido identificar todavia, no me
                  instancia el objeto.<br />
                  Con debug he verificado que entra en el if file exists, pero
                  no lo instancia.
                </p>
                <p>Alguna idea de donde debo buscar?</p>
                <p>gracias</p>
              </li>

              <li class="alt" id="comment-22007">
                <cite>joropo</cite> Says:
                <br />

                <small class="commentmetadata"
                  ><a href="#comment-22007" title=""
                    >agosto 28th, 2008 at 17:35</a
                  >
                </small>

                <p>much�simas gracias por la data.</p>
                <p>
                  el enlace a poEdit tiene un error: es poedit.net y no .org
                </p>
              </li>

              <li class="" id="comment-22008">
                <cite
                  ><a
                    href="http://www.satyam.com.ar"
                    rel="external nofollow"
                    class="url"
                    >Satyam</a
                  ></cite
                >
                Says:
                <br />

                <small class="commentmetadata"
                  ><a href="#comment-22008" title=""
                    >agosto 28th, 2008 at 17:59</a
                  >
                </small>

                <p>Gracias por la correci�n Joropo, ya est� actualizado.</p>
              </li>

              <li class="alt" id="comment-35362">
                <cite
                  ><a
                    href="http://janckos.net"
                    rel="external nofollow"
                    class="url"
                    >Janckos</a
                  ></cite
                >
                Says:
                <br />

                <small class="commentmetadata"
                  ><a href="#comment-35362" title=""
                    >mayo 22nd, 2009 at 15:19</a
                  >
                </small>

                <p>Muy buen articulo, gracias!.</p>
              </li>

              <li class="" id="comment-51806">
                <cite>Jose Alberto</cite> Says:
                <br />

                <small class="commentmetadata"
                  ><a href="#comment-51806" title=""
                    >diciembre 23rd, 2011 at 15:27</a
                  >
                </small>

                <p>
                  Muchas gracias por la información, me ha sido de gran ayuda.
                </p>
              </li>
            </ol>
          </div>
          <p align="center"></p>
        </div>
        <div id="sidebar">
          <h2>Archived Entry</h2>
          <ul>
            <li><strong>Post Date :</strong></li>
            <li>martes, Ene 16th, 2007 at 21:48</li>
            <li><strong>Categoría :</strong></li>
            <li>
              <a
                href="http://www.satyam.com.ar/blog/category/tecnologia/programacion/"
                rel="category tag"
                >Programación</a
              >
            </li>
            <li><strong>Do More :</strong></li>
            <li>Both comments and pings are currently closed.</li>
          </ul>
        </div>

        <p id="footer">
          Design Downloaded from
          <a href="http://www.vanillamist.com" title="Vanilla Mist"
            >www.vanillamist.com</a
          >
        </p>
      </div>
    </div>
  </body>
</html>
