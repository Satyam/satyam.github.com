<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>js&#x2F;sort.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/DataTable.html">DataTable</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.Base.html">DataTable.Base</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.BaseCellEditor.html">DataTable.BaseCellEditor</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.BaseCellEditor.KeyFiltering.html">DataTable.BaseCellEditor.KeyFiltering</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.BaseCellInlineEditor.html">DataTable.BaseCellInlineEditor</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.BaseCellPopupEditor.html">DataTable.BaseCellPopupEditor</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.BodyView.html">DataTable.BodyView</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.BodyView.Formatters.html">DataTable.BodyView.Formatters</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.BodyView.InputFormatters.html">DataTable.BodyView.InputFormatters</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.ColumnWidths.html">DataTable.ColumnWidths</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.Core.html">DataTable.Core</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.Editable.html">DataTable.Editable</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.Editors.html">DataTable.Editors</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.HeaderView.html">DataTable.HeaderView</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.Message.html">DataTable.Message</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.Mutable.html">DataTable.Mutable</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.Scrollable.html">DataTable.Scrollable</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.Sortable.html">DataTable.Sortable</a></li>
            
                <li><a href="..&#x2F;classes/DataTable.TableView.html">DataTable.TableView</a></li>
            
                <li><a href="..&#x2F;classes/Plugin.DataTableDataSource.html">Plugin.DataTableDataSource</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/datatable.html">datatable</a></li>
            
                <li><a href="..&#x2F;modules/datatable-base.html">datatable-base</a></li>
            
                <li><a href="..&#x2F;modules/datatable-body.html">datatable-body</a></li>
            
                <li><a href="..&#x2F;modules/datatable-celleditor-base.html">datatable-celleditor-base</a></li>
            
                <li><a href="..&#x2F;modules/datatable-celleditor-inline.html">datatable-celleditor-inline</a></li>
            
                <li><a href="..&#x2F;modules/datatable-celleditor-keyfiltering.html">datatable-celleditor-keyfiltering</a></li>
            
                <li><a href="..&#x2F;modules/datatable-celleditor-popup.html">datatable-celleditor-popup</a></li>
            
                <li><a href="..&#x2F;modules/datatable-column-widths.html">datatable-column-widths</a></li>
            
                <li><a href="..&#x2F;modules/datatable-core.html">datatable-core</a></li>
            
                <li><a href="..&#x2F;modules/datatable-datasource.html">datatable-datasource</a></li>
            
                <li><a href="..&#x2F;modules/datatable-editable.html">datatable-editable</a></li>
            
                <li><a href="..&#x2F;modules/datatable-formatters.html">datatable-formatters</a></li>
            
                <li><a href="..&#x2F;modules/datatable-head.html">datatable-head</a></li>
            
                <li><a href="..&#x2F;modules/datatable-input-formatters.html">datatable-input-formatters</a></li>
            
                <li><a href="..&#x2F;modules/datatable-message.html">datatable-message</a></li>
            
                <li><a href="..&#x2F;modules/datatable-mutable.html">datatable-mutable</a></li>
            
                <li><a href="..&#x2F;modules/datatable-scroll.html">datatable-scroll</a></li>
            
                <li><a href="..&#x2F;modules/datatable-sort.html">datatable-sort</a></li>
            
                <li><a href="..&#x2F;modules/datatable-table.html">datatable-table</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: js&#x2F;sort.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
Adds support for sorting the table data by API methods &#x60;table.sort(...)&#x60; or
&#x60;table.toggleSort(...)&#x60; or by clicking on column headers in the rendered UI.

@module datatable
@submodule datatable-sort
@since 3.5.0
**&#x2F;
var YLang     = Y.Lang,
    isBoolean = YLang.isBoolean,
    isString  = YLang.isString,
    isArray   = YLang.isArray,
    isObject  = YLang.isObject,

    toArray = Y.Array,
    sub     = YLang.sub,

    dirMap = {
        asc : 1,
        desc: -1,
        &quot;1&quot; : 1,
        &quot;-1&quot;: -1
    };


&#x2F;**
_API docs for this extension are included in the DataTable class._

This DataTable class extension adds support for sorting the table data by API
methods &#x60;table.sort(...)&#x60; or &#x60;table.toggleSort(...)&#x60; or by clicking on column
headers in the rendered UI.

Sorting by the API is enabled automatically when this module is &#x60;use()&#x60;d.  To
enable UI triggered sorting, set the DataTable&#x27;s &#x60;sortable&#x60; attribute to
&#x60;true&#x60;.

&lt;pre&gt;&lt;code&gt;
var table = new Y.DataTable({
    columns: [ &#x27;id&#x27;, &#x27;username&#x27;, &#x27;name&#x27;, &#x27;birthdate&#x27; ],
    data: [ ... ],
    sortable: true
});

table.render(&#x27;#table&#x27;);
&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;

Setting &#x60;sortable&#x60; to &#x60;true&#x60; will enable UI sorting for all columns.  To enable
UI sorting for certain columns only, set &#x60;sortable&#x60; to an array of column keys,
or just add &#x60;sortable: true&#x60; to the respective column configuration objects.
This uses the default setting of &#x60;sortable: auto&#x60; for the DataTable instance.

&lt;pre&gt;&lt;code&gt;
var table = new Y.DataTable({
    columns: [
        &#x27;id&#x27;,
        { key: &#x27;username&#x27;,  sortable: true },
        { key: &#x27;name&#x27;,      sortable: true },
        { key: &#x27;birthdate&#x27;, sortable: true }
    ],
    data: [ ... ]
    &#x2F;&#x2F; sortable: &#x27;auto&#x27; is the default
});

&#x2F;&#x2F; OR
var table = new Y.DataTable({
    columns: [ &#x27;id&#x27;, &#x27;username&#x27;, &#x27;name&#x27;, &#x27;birthdate&#x27; ],
    data: [ ... ],
    sortable: [ &#x27;username&#x27;, &#x27;name&#x27;, &#x27;birthdate&#x27; ]
});
&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;

To disable UI sorting for all columns, set &#x60;sortable&#x60; to &#x60;false&#x60;.  This still
permits sorting via the API methods.

As new records are inserted into the table&#x27;s &#x60;data&#x60; ModelList, they will be inserted at the correct index to preserve the sort order.

The current sort order is stored in the &#x60;sortBy&#x60; attribute.  Assigning this value at instantiation will automatically sort your data.

Sorting is done by a simple value comparison using &amp;lt; and &amp;gt; on the field
value.  If you need custom sorting, add a sort function in the column&#x27;s
&#x60;sortFn&#x60; property.  Columns whose content is generated by formatters, but don&#x27;t
relate to a single &#x60;key&#x60;, require a &#x60;sortFn&#x60; to be sortable.

&lt;pre&gt;&lt;code&gt;
function nameSort(a, b, desc) {
    var aa = a.get(&#x27;lastName&#x27;) + a.get(&#x27;firstName&#x27;),
        bb = a.get(&#x27;lastName&#x27;) + b.get(&#x27;firstName&#x27;),
        order = (aa &gt; bb) ? 1 : -(aa &lt; bb);

    return desc ? -order : order;
}

var table = new Y.DataTable({
    columns: [ &#x27;id&#x27;, &#x27;username&#x27;, { key: name, sortFn: nameSort }, &#x27;birthdate&#x27; ],
    data: [ ... ],
    sortable: [ &#x27;username&#x27;, &#x27;name&#x27;, &#x27;birthdate&#x27; ]
});
&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;

See the user guide for more details.

@class DataTable.Sortable
@for DataTable
@since 3.5.0
**&#x2F;
function Sortable() {}

Sortable.ATTRS = {
    &#x2F;&#x2F; Which columns in the UI should suggest and respond to sorting interaction
    &#x2F;&#x2F; pass an empty array if no UI columns should show sortable, but you want the
    &#x2F;&#x2F; table.sort(...) API
    &#x2F;**
    Controls which column headers can trigger sorting by user clicks.

    Acceptable values are:

     * &quot;auto&quot; - (default) looks for &#x60;sortable: true&#x60; in the column configurations
     * &#x60;true&#x60; - all columns are enabled
     * &#x60;false - no UI sortable is enabled
     * {String[]} - array of key names to give sortable headers

    @attribute sortable
    @type {String|String[]|Boolean}
    @default &quot;auto&quot;
    @since 3.5.0
    **&#x2F;
    sortable: {
        value: &#x27;auto&#x27;,
        validator: &#x27;_validateSortable&#x27;
    },

    &#x2F;**
    The current sort configuration to maintain in the data.

    Accepts column &#x60;key&#x60; strings or objects with a single property, the column
    &#x60;key&#x60;, with a value of 1, -1, &quot;asc&quot;, or &quot;desc&quot;.  E.g. &#x60;{ username: &#x27;asc&#x27;
    }&#x60;.  String values are assumed to be ascending.

    Example values would be:

     * &#x60;&quot;username&quot;&#x60; - sort by the data&#x27;s &#x60;username&#x60; field or the &#x60;key&#x60;
       associated to a column with that &#x60;name&#x60;.
     * &#x60;{ username: &quot;desc&quot; }&#x60; - sort by &#x60;username&#x60; in descending order.
       Alternately, use values &quot;asc&quot;, 1 (same as &quot;asc&quot;), or -1 (same as &quot;desc&quot;).
     * &#x60;[&quot;lastName&quot;, &quot;firstName&quot;]&#x60; - ascending sort by &#x60;lastName&#x60;, but for
       records with the same &#x60;lastName&#x60;, ascending subsort by &#x60;firstName&#x60;.
       Array can have as many items as you want.
     * &#x60;[{ lastName: -1 }, &quot;firstName&quot;]&#x60; - descending sort by &#x60;lastName&#x60;,
       ascending subsort by &#x60;firstName&#x60;. Mixed types are ok.

    @attribute sortBy
    @type {String|String[]|Object|Object[]}
    @since 3.5.0
    **&#x2F;
    sortBy: {
        validator: &#x27;_validateSortBy&#x27;,
        getter: &#x27;_getSortBy&#x27;
    },

    &#x2F;**
    Strings containing language for sorting tooltips.

    @attribute strings
    @type {Object}
    @default (strings for current lang configured in the YUI instance config)
    @since 3.5.0
    **&#x2F;
    strings: {}
};

Y.mix(Sortable.prototype, {

    &#x2F;**
    Sort the data in the &#x60;data&#x60; ModelList and refresh the table with the new
    order.

    Acceptable values for &#x60;fields&#x60; are &#x60;key&#x60; strings or objects with a single
    property, the column &#x60;key&#x60;, with a value of 1, -1, &quot;asc&quot;, or &quot;desc&quot;.  E.g.
    &#x60;{ username: &#x27;asc&#x27; }&#x60;.  String values are assumed to be ascending.

    Example values would be:

     * &#x60;&quot;username&quot;&#x60; - sort by the data&#x27;s &#x60;username&#x60; field or the &#x60;key&#x60;
       associated to a column with that &#x60;name&#x60;.
     * &#x60;{ username: &quot;desc&quot; }&#x60; - sort by &#x60;username&#x60; in descending order.
       Alternately, use values &quot;asc&quot;, 1 (same as &quot;asc&quot;), or -1 (same as &quot;desc&quot;).
     * &#x60;[&quot;lastName&quot;, &quot;firstName&quot;]&#x60; - ascending sort by &#x60;lastName&#x60;, but for
       records with the same &#x60;lastName&#x60;, ascending subsort by &#x60;firstName&#x60;.
       Array can have as many items as you want.
     * &#x60;[{ lastName: -1 }, &quot;firstName&quot;]&#x60; - descending sort by &#x60;lastName&#x60;,
       ascending subsort by &#x60;firstName&#x60;. Mixed types are ok.

    @method sort
    @param {String|String[]|Object|Object[]} fields The field(s) to sort by
    @param {Object} [payload] Extra &#x60;sort&#x60; event payload you want to send along
    @return {DataTable}
    @chainable
    @since 3.5.0
    **&#x2F;
    sort: function (fields, payload) {
        &#x2F;**
        Notifies of an impending sort, either from clicking on a column
        header, or from a call to the &#x60;sort&#x60; or &#x60;toggleSort&#x60; method.

        The requested sort is available in the &#x60;sortBy&#x60; property of the event.

        The default behavior of this event sets the table&#x27;s &#x60;sortBy&#x60; attribute.

        @event sort
        @param {String|String[]|Object|Object[]} sortBy The requested sort
        @preventable _defSortFn
        **&#x2F;
        return this.fire(&#x27;sort&#x27;, Y.merge((payload || {}), {
            sortBy: fields || this.get(&#x27;sortBy&#x27;)
        }));
    },

    &#x2F;**
    Template for the node that will wrap the header content for sortable
    columns.

    @property SORTABLE_HEADER_TEMPLATE
    @type {HTML}
    @value &#x27;&lt;div class=&quot;{className}&quot; tabindex=&quot;0&quot;&gt;&lt;span class=&quot;{indicatorClass}&quot;&gt;&lt;&#x2F;span&gt;&lt;&#x2F;div&gt;&#x27;
    @since 3.5.0
    **&#x2F;
    SORTABLE_HEADER_TEMPLATE: &#x27;&lt;div class=&quot;{className}&quot; tabindex=&quot;0&quot; unselectable=&quot;on&quot;&gt;&lt;span class=&quot;{indicatorClass}&quot;&gt;&lt;&#x2F;span&gt;&lt;&#x2F;div&gt;&#x27;,

    &#x2F;**
    Reverse the current sort direction of one or more fields currently being
    sorted by.

    Pass the &#x60;key&#x60; of the column or columns you want the sort order reversed
    for.

    @method toggleSort
    @param {String|String[]} fields The field(s) to reverse sort order for
    @param {Object} [payload] Extra &#x60;sort&#x60; event payload you want to send along
    @return {DataTable}
    @chainable
    @since 3.5.0
    **&#x2F;
    toggleSort: function (columns, payload) {
        var current = this._sortBy,
            sortBy = [],
            i, len, j, col, index;

        &#x2F;&#x2F; To avoid updating column configs or sortBy directly
        for (i = 0, len = current.length; i &lt; len; ++i) {
            col = {};
            col[current[i]._id] = current[i].sortDir;
            sortBy.push(col);
        }

        if (columns) {
            columns = toArray(columns);

            for (i = 0, len = columns.length; i &lt; len; ++i) {
                col = columns[i];
                index = -1;

                for (j = sortBy.length - 1; i &gt;= 0; --i) {
                    if (sortBy[j][col]) {
                        sortBy[j][col] *= -1;
                        break;
                    }
                }
            }
        } else {
            for (i = 0, len = sortBy.length; i &lt; len; ++i) {
                for (col in sortBy[i]) {
                    if (sortBy[i].hasOwnProperty(col)) {
                        sortBy[i][col] *= -1;
                        break;
                    }
                }
            }
        }

        return this.fire(&#x27;sort&#x27;, Y.merge((payload || {}), {
            sortBy: sortBy
        }));
    },

    &#x2F;&#x2F;--------------------------------------------------------------------------
    &#x2F;&#x2F; Protected properties and methods
    &#x2F;&#x2F;--------------------------------------------------------------------------
    &#x2F;**
    Sorts the &#x60;data&#x60; ModelList based on the new &#x60;sortBy&#x60; configuration.

    @method _afterSortByChange
    @param {EventFacade} e The &#x60;sortByChange&#x60; event
    @protected
    @since 3.5.0
    **&#x2F;
    _afterSortByChange: function () {
        &#x2F;&#x2F; Can&#x27;t use a setter because it&#x27;s a chicken and egg problem. The
        &#x2F;&#x2F; columns need to be set up to translate, but columns are initialized
        &#x2F;&#x2F; from Core&#x27;s initializer.  So construction-time assignment would
        &#x2F;&#x2F; fail.
        this._setSortBy();

        &#x2F;&#x2F; Don&#x27;t sort unless sortBy has been set
        if (this._sortBy.length) {
            if (!this.data.comparator) {
                 this.data.comparator = this._sortComparator;
            }

            this.data.sort();
        }
    },

    &#x2F;**
    Applies the sorting logic to the new ModelList if the &#x60;newVal&#x60; is a new
    ModelList.

    @method _afterSortDataChange
    @param {EventFacade} e the &#x60;dataChange&#x60; event
    @protected
    @since 3.5.0
    **&#x2F;
    _afterSortDataChange: function (e) {
        &#x2F;&#x2F; object values always trigger a change event, but we only want to
        &#x2F;&#x2F; call _initSortFn if the value passed to the &#x60;data&#x60; attribute was a
        &#x2F;&#x2F; new ModelList, not a set of new data as an array, or even the same
        &#x2F;&#x2F; ModelList.
        if (e.prevVal !== e.newVal || e.newVal.hasOwnProperty(&#x27;_compare&#x27;)) {
            this._initSortFn();
        }
    },

    &#x2F;**
    Checks if any of the fields in the modified record are fields that are
    currently being sorted by, and if so, resorts the &#x60;data&#x60; ModelList.

    @method _afterSortRecordChange
    @param {EventFacade} e The Model&#x27;s &#x60;change&#x60; event
    @protected
    @since 3.5.0
    **&#x2F;
    _afterSortRecordChange: function (e) {
        var i, len;

        for (i = 0, len = this._sortBy.length; i &lt; len; ++i) {
            if (e.changed[this._sortBy[i].key]) {
                this.data.sort();
                break;
            }
        }
    },

    &#x2F;**
    Subscribes to state changes that warrant updating the UI, and adds the
    click handler for triggering the sort operation from the UI.

    @method _bindSortUI
    @protected
    @since 3.5.0
    **&#x2F;
    _bindSortUI: function () {
        var handles = this._eventHandles;

        if (!handles.sortAttrs) {
            handles.sortAttrs = this.after(
                [&#x27;sortableChange&#x27;, &#x27;sortByChange&#x27;, &#x27;columnsChange&#x27;],
                Y.bind(&#x27;_uiSetSortable&#x27;, this));
        }

        if (!handles.sortUITrigger &amp;&amp; this._theadNode) {
            handles.sortUITrigger = this.delegate([&#x27;click&#x27;,&#x27;keydown&#x27;],
                Y.rbind(&#x27;_onUITriggerSort&#x27;, this),
                &#x27;.&#x27; + this.getClassName(&#x27;sortable&#x27;, &#x27;column&#x27;));
        }
    },

    &#x2F;**
    Sets the &#x60;sortBy&#x60; attribute from the &#x60;sort&#x60; event&#x27;s &#x60;e.sortBy&#x60; value.

    @method _defSortFn
    @param {EventFacade} e The &#x60;sort&#x60; event
    @protected
    @since 3.5.0
    **&#x2F;
    _defSortFn: function (e) {
        this.set.apply(this, [&#x27;sortBy&#x27;, e.sortBy].concat(e.details));
    },

    &#x2F;**
    Getter for the &#x60;sortBy&#x60; attribute.

    Supports the special subattribute &quot;sortBy.state&quot; to get a normalized JSON
    version of the current sort state.  Otherwise, returns the last assigned
    value.

    For example:

    &lt;pre&gt;&lt;code&gt;var table = new Y.DataTable({
        columns: [ ... ],
        data: [ ... ],
        sortBy: &#x27;username&#x27;
    });

    table.get(&#x27;sortBy&#x27;); &#x2F;&#x2F; &#x27;username&#x27;
    table.get(&#x27;sortBy.state&#x27;); &#x2F;&#x2F; { key: &#x27;username&#x27;, dir: 1 }

    table.sort([&#x27;lastName&#x27;, { firstName: &quot;desc&quot; }]);
    table.get(&#x27;sortBy&#x27;); &#x2F;&#x2F; [&#x27;lastName&#x27;, { firstName: &quot;desc&quot; }]
    table.get(&#x27;sortBy.state&#x27;); &#x2F;&#x2F; [{ key: &quot;lastName&quot;, dir: 1 }, { key: &quot;firstName&quot;, dir: -1 }]
    &lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;

    @method _getSortBy
    @param {String|String[]|Object|Object[]} val The current sortBy value
    @param {String} detail String passed to &#x60;get(HERE)&#x60;. to parse subattributes
    @protected
    @since 3.5.0
    **&#x2F;
    _getSortBy: function (val, detail) {
        var state, i, len, col;

        &#x2F;&#x2F; &quot;sortBy.&quot; is 7 characters. Used to catch
        detail = detail.slice(7);

        &#x2F;&#x2F; TODO: table.get(&#x27;sortBy.asObject&#x27;)? table.get(&#x27;sortBy.json&#x27;)?
        if (detail === &#x27;state&#x27;) {
            state = [];

            for (i = 0, len = this._sortBy.length; i &lt; len; ++i) {
                col = this._sortBy[i];
                state.push({
                    column: col._id,
                    dir: col.sortDir
                });
            }

            &#x2F;&#x2F; TODO: Always return an array?
            return { state: (state.length === 1) ? state[0] : state };
        } else {
            return val;
        }
    },

    &#x2F;**
    Sets up the initial sort state and instance properties.  Publishes events
    and subscribes to attribute change events to maintain internal state.

    @method initializer
    @protected
    @since 3.5.0
    **&#x2F;
    initializer: function () {
        var boundParseSortable = Y.bind(&#x27;_parseSortable&#x27;, this);

        this._parseSortable();

        this._setSortBy();

        this._initSortFn();

        this._initSortStrings();

        this.after({
            &#x27;table:renderHeader&#x27;: Y.bind(&#x27;_renderSortable&#x27;, this),
            dataChange          : Y.bind(&#x27;_afterSortDataChange&#x27;, this),
            sortByChange        : Y.bind(&#x27;_afterSortByChange&#x27;, this),
            sortableChange      : boundParseSortable,
            columnsChange       : boundParseSortable
        });
        this.data.after(this.data.model.NAME + &quot;:change&quot;,
            Y.bind(&#x27;_afterSortRecordChange&#x27;, this));

        &#x2F;&#x2F; TODO: this event needs magic, allowing async remote sorting
        this.publish(&#x27;sort&#x27;, {
            defaultFn: Y.bind(&#x27;_defSortFn&#x27;, this)
        });
    },

    &#x2F;**
    Creates a &#x60;_compare&#x60; function for the &#x60;data&#x60; ModelList to allow custom
    sorting by multiple fields.

    @method _initSortFn
    @protected
    @since 3.5.0
    **&#x2F;
    _initSortFn: function () {
        var self = this;

        &#x2F;&#x2F; TODO: This should be a ModelList extension.
        &#x2F;&#x2F; FIXME: Modifying a component of the host seems a little smelly
        &#x2F;&#x2F; FIXME: Declaring inline override to leverage closure vs
        &#x2F;&#x2F; compiling a new function for each column&#x2F;sortable change or
        &#x2F;&#x2F; binding the _compare implementation to this, resulting in an
        &#x2F;&#x2F; extra function hop during sorting. Lesser of three evils?
        this.data._compare = function (a, b) {
            var cmp = 0,
                i, len, col, dir, cs, aa, bb;

            for (i = 0, len = self._sortBy.length; !cmp &amp;&amp; i &lt; len; ++i) {
                col = self._sortBy[i];
                dir = col.sortDir,
                cs = col.caseSensitive;

                if (col.sortFn) {
                    cmp = col.sortFn(a, b, (dir === -1));
                } else {
                    &#x2F;&#x2F; FIXME? Requires columns without sortFns to have key
                    aa = a.get(col.key) || &#x27;&#x27;;
                    bb = b.get(col.key) || &#x27;&#x27;;
                    if (!cs &amp;&amp; typeof(aa) === &quot;string&quot; &amp;&amp; typeof(bb) === &quot;string&quot;){&#x2F;&#x2F; Not case sensitive
                        aa = aa.toLowerCase();
                        bb = bb.toLowerCase();
                    }
                    cmp = (aa &gt; bb) ? dir : ((aa &lt; bb) ? -dir : 0);
                }
            }

            return cmp;
        };

        if (this._sortBy.length) {
            this.data.comparator = this._sortComparator;

            &#x2F;&#x2F; TODO: is this necessary? Should it be elsewhere?
            this.data.sort();
        } else {
            &#x2F;&#x2F; Leave the _compare method in place to avoid having to set it
            &#x2F;&#x2F; up again.  Mistake?
            delete this.data.comparator;
        }
    },

    &#x2F;**
    Add the sort related strings to the &#x60;strings&#x60; map.

    @method _initSortStrings
    @protected
    @since 3.5.0
    **&#x2F;
    _initSortStrings: function () {
        &#x2F;&#x2F; Not a valueFn because other class extensions will want to add to it
        this.set(&#x27;strings&#x27;, Y.mix((this.get(&#x27;strings&#x27;) || {}),
            Y.Intl.get(&#x27;datatable-sort&#x27;)));
    },

    &#x2F;**
    Fires the &#x60;sort&#x60; event in response to user clicks on sortable column
    headers.

    @method _onUITriggerSort
    @param {DOMEventFacade} e The &#x60;click&#x60; event
    @protected
    @since 3.5.0
    **&#x2F;
    _onUITriggerSort: function (e) {
        var id = e.currentTarget.getAttribute(&#x27;data-yui3-col-id&#x27;),
            sortBy = e.shiftKey ? this.get(&#x27;sortBy&#x27;) : [{}],
            column = id &amp;&amp; this.getColumn(id),
            i, len;

        if (e.type === &#x27;keydown&#x27; &amp;&amp; e.keyCode !== 32) {
            return;
        }

        &#x2F;&#x2F; In case a headerTemplate injected a link
        &#x2F;&#x2F; TODO: Is this overreaching?
        e.preventDefault();

        if (column) {
            if (e.shiftKey) {
                for (i = 0, len = sortBy.length; i &lt; len; ++i) {
                    if (id === sortBy[i]  || Math.abs(sortBy[i][id]) === 1) {
                        if (!isObject(sortBy[i])) {
                            sortBy[i] = {};
                        }

                        sortBy[i][id] = -(column.sortDir||0) || 1;
                        break;
                    }
                }

                if (i &gt;= len) {
                    sortBy.push(column._id);
                }
            } else {
                sortBy[0][id] = -(column.sortDir||0) || 1;
            }

            this.fire(&#x27;sort&#x27;, {
                originEvent: e,
                sortBy: sortBy
            });
        }
    },

    &#x2F;**
    Normalizes the possible input values for the &#x60;sortable&#x60; attribute, storing
    the results in the &#x60;_sortable&#x60; property.

    @method _parseSortable
    @protected
    @since 3.5.0
    **&#x2F;
    _parseSortable: function () {
        var sortable = this.get(&#x27;sortable&#x27;),
            columns  = [],
            i, len, col;

        if (isArray(sortable)) {
            for (i = 0, len = sortable.length; i &lt; len; ++i) {
                col = sortable[i];

                &#x2F;&#x2F; isArray is called because arrays are objects, but will rely
                &#x2F;&#x2F; on getColumn to nullify them for the subsequent if (col)
                if (!isObject(col, true) || isArray(col)) {
                    col = this.getColumn(col);
                }

                if (col) {
                    columns.push(col);
                }
            }
        } else if (sortable) {
            columns = this._displayColumns.slice();

            if (sortable === &#x27;auto&#x27;) {
                for (i = columns.length - 1; i &gt;= 0; --i) {
                    if (!columns[i].sortable) {
                        columns.splice(i, 1);
                    }
                }
            }
        }

        this._sortable = columns;
    },

    &#x2F;**
    Initial application of the sortable UI.

    @method _renderSortable
    @protected
    @since 3.5.0
    **&#x2F;
    _renderSortable: function () {
        this._uiSetSortable();

        this._bindSortUI();
    },

    &#x2F;**
    Parses the current &#x60;sortBy&#x60; attribute into a normalized structure for the
    &#x60;data&#x60; ModelList&#x27;s &#x60;_compare&#x60; method.  Also updates the column
    configurations&#x27; &#x60;sortDir&#x60; properties.

    @method _setSortBy
    @protected
    @since 3.5.0
    **&#x2F;
    _setSortBy: function () {
        var columns     = this._displayColumns,
            sortBy      = this.get(&#x27;sortBy&#x27;) || [],
            sortedClass = &#x27; &#x27; + this.getClassName(&#x27;sorted&#x27;),
            i, len, name, dir, field, column;

        this._sortBy = [];

        &#x2F;&#x2F; Purge current sort state from column configs
        for (i = 0, len = columns.length; i &lt; len; ++i) {
            column = columns[i];

            delete column.sortDir;

            if (column.className) {
                &#x2F;&#x2F; TODO: be more thorough
                column.className = column.className.replace(sortedClass, &#x27;&#x27;);
            }
        }

        sortBy = toArray(sortBy);

        for (i = 0, len = sortBy.length; i &lt; len; ++i) {
            name = sortBy[i];
            dir  = 1;

            if (isObject(name)) {
                field = name;
                &#x2F;&#x2F; Have to use a for-in loop to process sort({ foo: -1 })
                for (name in field) {
                    if (field.hasOwnProperty(name)) {
                        dir = dirMap[field[name]];
                        break;
                    }
                }
            }

            if (name) {
                &#x2F;&#x2F; Allow sorting of any model field and any column
                &#x2F;&#x2F; FIXME: this isn&#x27;t limited to model attributes, but there&#x27;s no
                &#x2F;&#x2F; convenient way to get a list of the attributes for a Model
                &#x2F;&#x2F; subclass *including* the attributes of its superclasses.
                column = this.getColumn(name) || { _id: name, key: name };

                if (column) {
                    column.sortDir = dir;

                    if (!column.className) {
                        column.className = &#x27;&#x27;;
                    }

                    column.className += sortedClass;

                    this._sortBy.push(column);
                }
            }
        }
    },

    &#x2F;**
    Array of column configuration objects of those columns that need UI setup
    for user interaction.

    @property _sortable
    @type {Object[]}
    @protected
    @since 3.5.0
    **&#x2F;
    &#x2F;&#x2F;_sortable: null,

    &#x2F;**
    Array of column configuration objects for those columns that are currently
    being used to sort the data.  Fake column objects are used for fields that
    are not rendered as columns.

    @property _sortBy
    @type {Object[]}
    @protected
    @since 3.5.0
    **&#x2F;
    &#x2F;&#x2F;_sortBy: null,

    &#x2F;**
    Replacement &#x60;comparator&#x60; for the &#x60;data&#x60; ModelList that defers sorting logic
    to the &#x60;_compare&#x60; method.  The deferral is accomplished by returning &#x60;this&#x60;.

    @method _sortComparator
    @param {Model} item The record being evaluated for sort position
    @return {Model} The record
    @protected
    @since 3.5.0
    **&#x2F;
    _sortComparator: function (item) {
        &#x2F;&#x2F; Defer sorting to ModelList&#x27;s _compare
        return item;
    },

    &#x2F;**
    Applies the appropriate classes to the &#x60;boundingBox&#x60; and column headers to
    indicate sort state and sortability.

    Also currently wraps the header content of sortable columns in a &#x60;&lt;div&gt;&#x60;
    liner to give a CSS anchor for sort indicators.

    @method _uiSetSortable
    @protected
    @since 3.5.0
    **&#x2F;
    _uiSetSortable: function () {
        var columns       = this._sortable || [],
            sortableClass = this.getClassName(&#x27;sortable&#x27;, &#x27;column&#x27;),
            ascClass      = this.getClassName(&#x27;sorted&#x27;),
            descClass     = this.getClassName(&#x27;sorted&#x27;, &#x27;desc&#x27;),
            linerClass    = this.getClassName(&#x27;sort&#x27;, &#x27;liner&#x27;),
            indicatorClass= this.getClassName(&#x27;sort&#x27;, &#x27;indicator&#x27;),
            sortableCols  = {},
            i, len, col, node, liner, title, desc;

        this.get(&#x27;boundingBox&#x27;).toggleClass(
            this.getClassName(&#x27;sortable&#x27;),
            columns.length);

        for (i = 0, len = columns.length; i &lt; len; ++i) {
            sortableCols[columns[i].id] = columns[i];
        }

        &#x2F;&#x2F; TODO: this.head.render() + decorate cells?
        this._theadNode.all(&#x27;.&#x27; + sortableClass).each(function (node) {
            var col       = sortableCols[node.get(&#x27;id&#x27;)],
                liner     = node.one(&#x27;.&#x27; + linerClass),
                indicator;

            if (col) {
                if (!col.sortDir) {
                    node.removeClass(ascClass)
                        .removeClass(descClass);
                }
            } else {
                node.removeClass(sortableClass)
                    .removeClass(ascClass)
                    .removeClass(descClass);

                if (liner) {
                    liner.replace(liner.get(&#x27;childNodes&#x27;).toFrag());
                }

                indicator = node.one(&#x27;.&#x27; + indicatorClass);

                if (indicator) {
                    indicator.remove().destroy(true);
                }
            }
        });

        for (i = 0, len = columns.length; i &lt; len; ++i) {
            col  = columns[i];
            node = this._theadNode.one(&#x27;#&#x27; + col.id);
            desc = col.sortDir === -1;

            if (node) {
                liner = node.one(&#x27;.&#x27; + linerClass);

                node.addClass(sortableClass);

                if (col.sortDir) {
                    node.addClass(ascClass);

                    node.toggleClass(descClass, desc);

                    node.setAttribute(&#x27;aria-sort&#x27;, desc ?
                        &#x27;descending&#x27; : &#x27;ascending&#x27;);
                }

                if (!liner) {
                    liner = Y.Node.create(Y.Lang.sub(
                        this.SORTABLE_HEADER_TEMPLATE, {
                            className: linerClass,
                            indicatorClass: indicatorClass
                        }));

                    liner.prepend(node.get(&#x27;childNodes&#x27;).toFrag());

                    node.append(liner);
                }

                title = sub(this.getString(
                    (col.sortDir === 1) ? &#x27;reverseSortBy&#x27; : &#x27;sortBy&#x27;), {
                        column: col.abbr || col.label ||
                                col.key  || (&#x27;column &#x27; + i)
                });

                node.setAttribute(&#x27;title&#x27;, title);
                &#x2F;&#x2F; To combat VoiceOver from reading the sort title as the
                &#x2F;&#x2F; column header
                node.setAttribute(&#x27;aria-labelledby&#x27;, col.id);
            }
        }
    },

    &#x2F;**
    Allows values &#x60;true&#x60;, &#x60;false&#x60;, &quot;auto&quot;, or arrays of column names through.

    @method _validateSortable
    @param {Any} val The input value to &#x60;set(&quot;sortable&quot;, VAL)&#x60;
    @return {Boolean}
    @protected
    @since 3.5.0
    **&#x2F;
    _validateSortable: function (val) {
        return val === &#x27;auto&#x27; || isBoolean(val) || isArray(val);
    },

    &#x2F;**
    Allows strings, arrays of strings, objects, or arrays of objects.

    @method _validateSortBy
    @param {String|String[]|Object|Object[]} val The new &#x60;sortBy&#x60; value
    @return {Boolean}
    @protected
    @since 3.5.0
    **&#x2F;
    _validateSortBy: function (val) {
        return val === null ||
               isString(val) ||
               isObject(val, true) ||
               (isArray(val) &amp;&amp; (isString(val[0]) || isObject(val, true)));
    }

}, true);

Y.DataTable.Sortable = Sortable;

Y.Base.mix(Y.DataTable, [Sortable]);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
