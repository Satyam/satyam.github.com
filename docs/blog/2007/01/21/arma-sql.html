<!DOCTYPE html>
<html lang="es">
  <head>
    <!--Source file: 2007-01-21-arma-sql.html-->
    <meta charset="utf-8" />
    <base href="/blog/" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Arma SQL | Comentarios</title>
    <meta property="og:title" content="Arma SQL" />
    <meta property="og:locale" content="es-ES" />
    <meta name="description" content="

 Cansado de lidiar con el armado de instrucciones de SQL con argumentos
 variables, se me ocurri칩 hacer una funci칩n para manejarlo. Originalmente se
 llamaba ArmaSql, estaba en Visual Basic, lo que me tocaba en ese
 momento y funcionaba sobre MS-SQL. La versi칩n m치s reciente est치 en PHP y
 funciona sobre MySql y como la puse en alg칰n foro en ingl칠s por ah칤, se llama
 BuildSql(). Con muy pocos cambios se puede adaptar a cualquier otra base de datos, pero
 no me ha tocado hacerlo.

" />
    <meta property="og:description" content="

 Cansado de lidiar con el armado de instrucciones de SQL con argumentos
 variables, se me ocurri칩 hacer una funci칩n para manejarlo. Originalmente se
 llamaba ArmaSql, estaba en Visual Basic, lo que me tocaba en ese
 momento y funcionaba sobre MS-SQL. La versi칩n m치s reciente est치 en PHP y
 funciona sobre MySql y como la puse en alg칰n foro en ingl칠s por ah칤, se llama
 BuildSql(). Con muy pocos cambios se puede adaptar a cualquier otra base de datos, pero
 no me ha tocado hacerlo.

" />
    <link rel="canonical" href="http://www.satyam.com.ar/blog/2007/01/21/arma-sql.html" />
    <meta property="og:url" content="http://www.satyam.com.ar/blog/2007/01/21/arma-sql.html" />
    <meta property="og:site_name" content="Comentarios" />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2007-01-21T00:00:00+01:00" />
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Arma SQL" />
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "dateModified": "2007-01-21T00:00:00+01:00",
        "datePublished": "2007-01-21T00:00:00+01:00",
        "description": "

 Cansado de lidiar con el armado de instrucciones de SQL con argumentos
 variables, se me ocurri칩 hacer una funci칩n para manejarlo. Originalmente se
 llamaba ArmaSql, estaba en Visual Basic, lo que me tocaba en ese
 momento y funcionaba sobre MS-SQL. La versi칩n m치s reciente est치 en PHP y
 funciona sobre MySql y como la puse en alg칰n foro en ingl칠s por ah칤, se llama
 BuildSql(). Con muy pocos cambios se puede adaptar a cualquier otra base de datos, pero
 no me ha tocado hacerlo.

",
        "headline": "Arma SQL",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "http://www.satyam.com.ar/blog/2007/01/21/arma-sql.html"
        },
        "url": "http://www.satyam.com.ar/blog/2007/01/21/arma-sql.html"
      }
    </script>
    <link rel="stylesheet" href="assets/css/style.css" />
    <link
      type="application/atom+xml"
      rel="alternate"
      href="feed.xml"
      title="Comentarios"
    />
  </head>
  <body>
    <header class="site-header" role="banner">
      <div class="wrapper">
        <a class="site-title" rel="author" href="index.html">Comentarios</a>
        <nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path
                  d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"
                />
              </svg>
            </span>
          </label>

          <div class="trigger">
            
  <a class="page-link" href="" title="Home page">Home</a>
  <a class="page-link" href="posts.html" title="Art칤culos por fecha">Archivo</a>
  <a class="page-link" href="categories.html" title="Art칤culos por etiqueta">
    Etiquetas
  </a>

            <form
              id="searchform"
              method="get"
              action="https://www.google.com/search"
              target="_blank"
            >
              <input type="text" name="q" id="s" size="15" />
              <input type="submit" name="submit" value="游댌" />
              <input type="hidden" name="as_sitesearch" value="satyam.com.ar" />
            </form>
          </div>
        </nav>
      </div>
    </header>
    <main class="page-content" aria-label="Content" lang="es-ES">
      <div class="wrapper">
        <article
          class="post h-entry"
          itemscope
          itemtype="http://schema.org/BlogPosting"
        >
          <header class="post-header">
            <h1 class="post-title p-name" itemprop="name headline">
              Arma SQL
            </h1>
            
<div class="post-meta">
  <div class="date-published">
    Publicado el: 
    <time  datetime="2007-01-21T00:00:00+01:00" itemprop="datePublished">
    21 / Enero / 2007</time>
  </div>
  <div class="post-cats">Archivado bajo: <a
            href="categories/#Tecnologia_Programacion"
            rel="category tag"
            >Tecnolog칤a / Programaci칩n
            </a></div></div>
          </header>

          <div
            class="post-content e-content "
            itemprop="articleBody"
          >
            
<p>
  Cansado de lidiar con el armado de instrucciones de SQL con argumentos
  variables, se me ocurri칩 hacer una funci칩n para manejarlo. Originalmente se
  llamaba <code>ArmaSql</code>, estaba en Visual Basic, lo que me tocaba en ese
  momento y funcionaba sobre MS-SQL. La versi칩n m치s reciente est치 en PHP y
  funciona sobre MySql y como la puse en alg칰n foro en ingl칠s por ah칤, se llama
  <a
    title="C칩digo fuente de BuildSql"
    href="/int/ShowSource.php?title=BuildSql&file=BuildSql.php"
    ><code>BuildSql()</code></a
  >. Con muy pocos cambios se puede adaptar a cualquier otra base de datos, pero
  no me ha tocado hacerlo.
</p>
<span class="more"></span>
<p>
  Creo que lo m치s molesto es el manejo de las fechas y los cadenas nulos. Andar
  dando vuelta a las fechas para que queden bien en el formato aceptado por la
  base de datos y manejar la alternativa de que tanto una fecha o una cadena
  pueda ser nulo siempre me dio dolor de cabeza, pues me ha ocurrido de insertar
  inadvertidamente el texto <code>'null'</code> en lugar del valor
  <code>null</code> (sin comillas).
</p>
<p>
  Hice entonces esta funci칩n que es una suerte de
  <code
    ><a
      title="Manual de PHP: funci칩n sprintf()"
      href="http://es2.php.net/manual/es/function.sprintf.php"
      target="phpmanual"
      rel="noopener noreferrer"
      >sprintf()</a
    ></code
  >
  orientado a SQL. El problema que se me presentaba con
  <a
    title="Manual de PHP: funci칩n sprintf()"
    href="http://es2.php.net/manual/es/function.sprintf.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>sprintf()</code></a
  >
  era el de los valores en <code>null</code>, especialmente cadenas de
  caracteres y fechas, pues en el string de formato de
  <a
    title="Manual de PHP: funci칩n sprintf()"
    href="http://es2.php.net/manual/es/function.sprintf.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>sprintf()</code></a
  >
  ya pon칤a las comillas y si la variable estaba en
  <code>null</code>, terminaba escribiendo el texto <code>'null'</code> en la
  base de datos.
  <a
    title="Manual de PHP: funci칩n sprintf()"
    href="http://es2.php.net/manual/es/function.sprintf.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>sprintf()</code></a
  >
  no sabe que cuando el valor es <code>null</code> no debe incluir las comillas.
  Yo uso mucho el valor <code>null</code> en la base de datos, significa `no s칠췂
  o `no hay췂, indica la falta de un dato. Otros prefieren usar un valor
  convenido para indicar lo mismo, por ejemplo, cadenas vac칤as o importes en
  cero o negativos o alguna otra convenci칩n arbitraria que, en mi opini칩n es
  innecesaria pues SQL ya tiene previsto el valor <code>null</code> para eso. Es
  por ello que el <code>null</code> me preocupa tanto.
</p>
<p>
  Entonces, al igual que
  <a
    title="Manual de PHP: funci칩n sprintf()"
    href="http://es2.php.net/manual/es/function.sprintf.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>sprintf()</code></a
  >, la funci칩n
  <a
    title="C칩digo fuente de BuildSql"
    href="/int/ShowSource.php?title=BuildSql&file=BuildSql.php"
    ><code>BuildSql()</code></a
  >
  acepta un primer argumento que es el modelo de la instrucci칩n de SQL a armar y
  luego una cantidad variable de argumentos cuyos valores ser치n insertados en la
  primer cadena con el formato que le corresponda a cada uno. El lugar de
  inserci칩n de los valores va indicado por un signo de interrogaci칩n seguido de
  varios modificadores, seg칰n se indica:
</p>
<p><code>?[nn][m]t</code></p>
<p>Donde:</p>
<p>
  <code><em>nn</em></code
  >: opcional, indica la posici칩n del argumento dentro de la lista de
  argumentos. El argumento 0 es el modelo de la instrucci칩n misma y no tiene
  sentido usarlo. Si no se indica los argumentos se ir치n insertando
  secuencialmente seg칰n aparecen. Cuando se indica el n칰mero de argumento a
  usar, el puntero secuencial de argumentos no se incrementa.
</p>
<p><code>m</code>: opcional, puede ser una de dos opciones:</p>
<blockquote>
  <p>
    <code>m</code>: el argumento es obligatorio (en ingl칠s:
    <em><strong>m</strong>andatory</em>) el argumento no puede ser
    <code>null</code>. Dar치 error si lo fuera.<br />
    <code>n</code>: convertir a null si el argumento fuera 0 o una cadena vac칤a.
  </p>
</blockquote>
<p>
  <code>t</code>: este es el 칰nico modificador obligatorio e indica el tipo del
  argumento, que puede ser cualquiera de los siguientes:
</p>
<blockquote>
  <p>
    <code>s</code>: <em><strong>s</strong>tring</em><br />
    <code>i</code>: <em><strong>i</strong>nteger</em><br />
    <code>f</code>: <em><strong>f</strong>loat</em><br />
    <code>d</code>: <em><strong>d</strong>ate, datetime, timestamp</em><br />
    <code>t</code>: <em><strong>t</strong>ime</em><br />
    <code>b</code>: <em><strong>b</strong>oolean</em><br />
    <code>p</code>: <em><strong>p</strong>refijo</em>
  </p>
</blockquote>
<p>
  Todos estos modificadores pueden darse tanto en may칰sculas como en min칰sculas.
  Lo m칤nimo requerido es el signo de interrogaci칩n seguido de una descripci칩n
  del tipo de datos. En el caso de que el tipo de dato requiriera encerrar el
  valor entre comillas, la funci칩n las proveer치. No hay previsi칩n para insertar
  un signo de interrogaci칩n en la salida pues, como es un car치cter inv치lido en
  SQL, no tiene sentido, pero no hay problema en que cualquiera de los
  argumentos lo contenga.
</p>
<p>
  El tipo de datos `<code>p</code>` es especial en cuanto a que no representa un
  argumento sino el contenido de la variable
  <code>$table_prefix</code>. Dependiendo del servicio contratado con un
  proveedor de internet, es posible disponer de ilimitadas bases de datos o un
  n칰mero limitado, en ocasiones una sola. En ese caso, es necesario llamar a
  cada tabla con un prefijo que indique a qu칠 aplicaci칩n corresponde. El
  modificador p permite agregar autom치ticamente ese prefijo, tom치ndola de la
  variable global <code>$table_prefix</code> (un nombre arbitrario que puede
  cambiarse a gusto) supuestamente le칤do de la configuraci칩n de la aplicaci칩n.
</p>
<p>
  La funci칩n est치 comentada en el
  <a
    title="funci칩n BuildSql"
    href="/int/ShowSource.php?title=BuildSql&file=BuildSql.php"
    >fuente</a
  >
  e incluye un ejemplo.
</p>
<p>
  Esta funci칩n se complementa con <code>ReadSqlDate()</code>, m치s abajo en el
  mismo
  <a
    title="funci칩n BuildSql"
    href="/int/ShowSource.php?title=BuildSql&file=BuildSql.php"
    >fuente</a
  >
  que permite convertir una fecha, fecha-hora o
  <em>timestamp</em> al formato interno de PHP. Yo nunca he usado el tipo de
  dato time de SQL, por lo que no he previsto una funci칩n equivalente para ese
  tipo de dato. Vale la pena que advierta a quien quiera hacerlo que la funci칩n
  <a
    title="Manual de PHP: funci칩n mktime()"
    href="http://es2.php.net/manual/es/function.mktime.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>mktime()</code></a
  >, cuando no se le dan los argumentos mes, d칤a y a침o, no los supone cero sino
  que toma los valores actuales, por lo que al convertirlo, se deber치 usar:
</p>
<p>
  <code>mktime($hora,$minuto,$segundos) - $mktime(0,0,0)</code>
</p>
<p>y no simplemente:</p>
<p>mktime<code>($hora,$minuto,$segundos)</code></p>

          </div>
          <footer class="post-footer">
    <div class="next-prev-links">
      <a  class="prev-link" href="2007/01/25/din-a4.html"><div class="triangle-left"></div> Anterior</a>
      <a  class="next-link" href="2007/01/18/como-evitar-duplicar-registros-al-hacer-refrescar-f5-en-el-navegador.html">Siguiente <div class="triangle-right"></div></a>
    </div> </footer>
          <a class="u-url" href="/blog2007/01/21/arma-sql.html" hidden></a>
        </article>
      </div>
    </main>
    <footer class="site-footer h-card">
      <data class="u-url" href="/blog"></data>

      <div class="wrapper">
        <h2 class="footer-heading">Comentarios</h2>

        <div class="footer-col-wrapper">
          <div class="footer-col footer-col-1">
            <ul class="contact-list">
              <li class="p-name">Comentarios</li>
              <li>
                <a class="u-email" href="mailto:satyam@satyam.com.ar"
                  >satyam@satyam.com.ar</a
                >
              </li>
            </ul>
          </div>

          <div class="footer-col footer-col-2">
            <ul class="social-media-list"></ul>
          </div>

          <div class="footer-col footer-col-3">
            <p>Comentarios, viajes, ideas e historias</p>
          </div>
        </div>
      </div>
    </footer>
    
  </body>
</html>
