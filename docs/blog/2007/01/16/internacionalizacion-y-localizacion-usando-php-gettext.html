<!DOCTYPE html>
<html lang="es">
  <head>
    <!--Source file: 2007-01-16-internacionalizacion-y-localizacion-usando-php-gettext.html-->
    <meta charset="utf-8" />
    <base href="/blog/" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Internacionalizaci贸n y localizaci贸n: usando PHP-gettext | Comentarios</title>
    <meta property="og:title" content="Internacionalizaci贸n y localizaci贸n: usando PHP-gettext" />
    <meta property="og:locale" content="es-ES" />
    <meta name="description" content="

 Dados los problemas de uso de la biblioteca de funciones
 gettext()
 incorporadas dentro mismo de PHP mencionadas en el art铆culo anterior, mi
 sugerencia es usar
 PHP-gettext, un paquete que usan muchas aplicaciones, incluso WordPress, en que corre
 este blog. No s贸lo su uso es m谩s simple sino que tiene un
 README donde explica r谩pidamente su uso, dispone de ejemplos e
 incluye un archivo para hacer una emulaci贸n completa de la funcionalidad de la
 biblioteca gettext(), aunque vistos los problemas comentados, lo
 que menos puedo recomendar es usar una emulaci贸n que los reproduce hasta el
 煤ltimo dolor de cabeza." />
    <meta property="og:description" content="

 Dados los problemas de uso de la biblioteca de funciones
 gettext()
 incorporadas dentro mismo de PHP mencionadas en el art铆culo anterior, mi
 sugerencia es usar
 PHP-gettext, un paquete que usan muchas aplicaciones, incluso WordPress, en que corre
 este blog. No s贸lo su uso es m谩s simple sino que tiene un
 README donde explica r谩pidamente su uso, dispone de ejemplos e
 incluye un archivo para hacer una emulaci贸n completa de la funcionalidad de la
 biblioteca gettext(), aunque vistos los problemas comentados, lo
 que menos puedo recomendar es usar una emulaci贸n que los reproduce hasta el
 煤ltimo dolor de cabeza." />
    <link rel="canonical" href="http://www.satyam.com.ar/blog/2007/01/16/internacionalizacion-y-localizacion-usando-php-gettext.html" />
    <meta property="og:url" content="http://www.satyam.com.ar/blog/2007/01/16/internacionalizacion-y-localizacion-usando-php-gettext.html" />
    <meta property="og:site_name" content="Comentarios" />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2007-01-16T00:00:00+01:00" />
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Internacionalizaci贸n y localizaci贸n: usando PHP-gettext" />
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "dateModified": "2007-01-16T00:00:00+01:00",
        "datePublished": "2007-01-16T00:00:00+01:00",
        "description": "

 Dados los problemas de uso de la biblioteca de funciones
 gettext()
 incorporadas dentro mismo de PHP mencionadas en el art铆culo anterior, mi
 sugerencia es usar
 PHP-gettext, un paquete que usan muchas aplicaciones, incluso WordPress, en que corre
 este blog. No s贸lo su uso es m谩s simple sino que tiene un
 README donde explica r谩pidamente su uso, dispone de ejemplos e
 incluye un archivo para hacer una emulaci贸n completa de la funcionalidad de la
 biblioteca gettext(), aunque vistos los problemas comentados, lo
 que menos puedo recomendar es usar una emulaci贸n que los reproduce hasta el
 煤ltimo dolor de cabeza.",
        "headline": "Internacionalizaci贸n y localizaci贸n: usando PHP-gettext",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "http://www.satyam.com.ar/blog/2007/01/16/internacionalizacion-y-localizacion-usando-php-gettext.html"
        },
        "url": "http://www.satyam.com.ar/blog/2007/01/16/internacionalizacion-y-localizacion-usando-php-gettext.html"
      }
    </script>
    <link rel="stylesheet" href="assets/css/style.css" />
    <link
      type="application/atom+xml"
      rel="alternate"
      href="feed.xml"
      title="Comentarios"
    />
  </head>
  <body>
    <header class="site-header" role="banner">
      <div class="wrapper">
        <a class="site-title" rel="author" href="index.html">Comentarios</a>
        <nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path
                  d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"
                />
              </svg>
            </span>
          </label>

          <div class="trigger">
            
  <a class="page-link" href="" title="Home page">Home</a>
  <a class="page-link" href="posts.html" title="Art铆culos por fecha">Archivo</a>
  <a class="page-link" href="categories.html" title="Art铆culos por etiqueta">
    Etiquetas
  </a>

            <form
              id="searchform"
              method="get"
              action="https://www.google.com/search"
              target="_blank"
            >
              <input type="text" name="q" id="s" size="15" />
              <input type="submit" name="submit" value="" />
              <input type="hidden" name="as_sitesearch" value="satyam.com.ar" />
            </form>
          </div>
        </nav>
      </div>
    </header>
    <main class="page-content" aria-label="Content" lang="es-ES">
      <div class="wrapper">
        <article
          class="post h-entry"
          itemscope
          itemtype="http://schema.org/BlogPosting"
        >
          <header class="post-header">
            <h1 class="post-title p-name" itemprop="name headline">
              Internacionalizaci贸n y localizaci贸n: usando PHP-gettext
            </h1>
            
<div class="post-meta">
  <div class="date-published">
    Publicado el: 
    <time  datetime="2007-01-16T00:00:00+01:00" itemprop="datePublished">
    16 / Enero / 2007</time>
  </div>
  <div class="post-cats">Archivado bajo: <a
            href="categories/#Tecnologia_Programacion"
            rel="category tag"
            >Tecnolog铆a / Programaci贸n
            </a></div></div>
          </header>

          <div
            class="post-content e-content "
            itemprop="articleBody"
          >
            
<p>
  Dados los problemas de uso de la biblioteca de funciones
  <a
    title="Manual de PHP: funciones de gettext"
    target="phpmanual"
    href="http://es2.php.net/manual/es/ref.gettext.php"
    ><code>gettext()</code></a
  >
  incorporadas dentro mismo de PHP mencionadas en el art铆culo anterior, mi
  sugerencia es usar
  <a
    title="PHP-gettext"
    target="_blank"
    href="http://savannah.nongnu.org/projects/php-gettext/"
    >PHP-gettext</a
  >, un paquete que usan muchas aplicaciones, incluso WordPress, en que corre
  este blog. No s贸lo su uso es m谩s simple sino que tiene un
  <code>README</code> donde explica r谩pidamente su uso, dispone de ejemplos e
  incluye un archivo para hacer una emulaci贸n completa de la funcionalidad de la
  biblioteca <code>gettext()</code>, aunque vistos los problemas comentados, lo
  que menos puedo recomendar es usar una emulaci贸n que los reproduce hasta el
  煤ltimo dolor de cabeza.<span class="more"></span>
</p>
<p>
  Usar este paquete requiere, b谩sicamente, incluir un par de archivos que se
  proveen, como se ve en el ejemplo:
</p>
<p>
  <code
    ><span style="color: #007700">include </span
    ><span style="color: #dd0000">'php-gettext-1.0.7/streams.php'</span></code
  ><code
    ><span style="color: #007700"
      >;<br />
      include </span
    ><span style="color: #dd0000">'php-gettext-1.0.7/gettext.php'</span
    ><span style="color: #007700">;</span></code
  >
</p>
<p>
  La raz贸n de dividir el paquete en dos archivos es que el segundo es el que
  provee la funcionalidad de
  <code>gettext</code> mientras que el primero es el que lee el archivo de
  traducciones y puede ser reemplazado por otro que acceda a este archivo por
  otro mecanismo.
</p>
<p>
  La carga del archivo de traducciones en s铆 se hace mediante el siguiente
  c贸digo:
</p>
<p>
  <code
    ><font color="#007700">if (</font
    ><span style="color: #0000bb">file_exists</span
    ><span style="color: #007700">(</span
    ><span style="color: #0000bb">$_SESSION</span
    ><span style="color: #007700">[</span
    ><span style="color: #dd0000">'language'</span
    ><span style="color: #007700">] . </span
    ><span style="color: #dd0000">'.mo'</span></code
  ><code
    ><span style="color: #007700">)) {<br /> </span
    ><span style="color: #0000bb"> $gettext_tables </span
    ><span style="color: #007700">= new </span
    ><span style="color: #0000bb">gettext_reader</span
    ><span style="color: #007700"
      >(<br />
      new </span
    ><span style="color: #0000bb">CachedFileReader</span
    ><span style="color: #007700">(</span
    ><span style="color: #0000bb">$_SESSION</span
    ><span style="color: #007700">[</span
    ><span style="color: #dd0000">'language'</span
    ><span style="color: #007700">] . </span
    ><span style="color: #dd0000">'.mo'</span></code
  ><code
    ><span style="color: #007700"
      >)<br />
      );<br /> </span
    ><span style="color: #0000bb"> $gettext_tables</span
    ><span style="color: #007700">-></span
    ><span style="color: #0000bb">load_tables</span></code
  ><span style="color: #007700"
    ><code
      >();<br />
      }</code
    ></span
  >
</p>
<p>
  Como se puede ver, el archivo de traducciones se puede ubicar donde uno
  prefiera, el control es total. En este caso, primero verifico que exista y
  luego genero una instancia del
  <code>CachedFileReader</code> indic谩ndole la ubicaci贸n del archivo. A su vez,
  este objeto se usa en el constructor de <code>gettext_reader</code>, que es el
  objeto que proveer谩 toda la funcionalidad de <code>gettext</code>. Finalmente,
  se invoca el m茅todo que carga las tablas. El paquete permite tanto cachear las
  tablas en memoria (predeterminado) o accederlas directamente a disco, en cuyo
  caso el <code>FileReader</code> almacena los punteros a las traducciones
  accedi茅ndolas directamente del archivo. Esto se determina mediante un
  argumento opcional en el lector o instanciando distintos lectores.
</p>
<p>
  La idea de usar el nombre <code>_()</code> para la funci贸n de traducci贸n es
  muy bueno, pero como ya est谩 tomado y no es posible redefinirlo, usamos
  <code>__()</code>, que es igualmente breve y legible, donde la legibilidad
  est谩 en la facilidad de leer los textos a traducir, pues a la parte ejecutable
  no le afecta.
</p>
<pre><span style="color: #007700">function </span><span style="color: #0000bb">__</span><span style="color: #007700">(</span><span style="color: #0000bb">$texto</span><span style="color: #007700">) {
global </span><span style="color: #0000bb">$gettext_tables</span><span style="color: #007700">;</span><span style="color: #007700">

if (</span><span style="color: #0000bb">is_null</span><span style="color: #007700">(</span><span style="color: #0000bb">$gettext_tables</span><span style="color: #007700">)) return </span><span style="color: #0000bb">$texto</span><span style="color: #007700">;
else return </span><span style="color: #0000bb">$gettext_tables</span><span style="color: #007700">-></span><span style="color: #0000bb">translate</span><span style="color: #007700">(</span><span style="color: #0000bb">$texto</span><span style="color: #007700">);
}</span></pre>
<p>
  Esta funci贸n verifica que el objeto haya sido instanciado con 茅xito y si es
  as铆, llama al m茅todo . En cualquier caso, ya fuera que la traducci贸n no
  existiera, un texto individual o el archivo de traducciones completo, la
  funci贸n devuelve el texto original con lo que, al menos, el usuario no se
  queda mirando una pantalla en blanco.A partir de all铆, el resto del programa
  es simple, cada vez que se quiere usar una cadena localizable, se la encierra
  en una llamada a la funci贸n y listo.Probablemente ya hayan notado que no es
  necesario inventar identificadores para las cadenas a traducir, el texto en el
  idioma original es la clave de b煤squeda por lo que en el caso de no haber una
  traducci贸n, siempre se dispone de alg煤n texto, aunque fuera en un idioma que
  no corresponde al pedido por el usuario.
</p>
<p>
  A todo esto, no hemos aclarado c贸mo se genera un archivo
  <code>.mo</code>, ni hemos explicado la estructura del archivo de
  traducciones.
</p>
<p>
  La clave del uso del paquete <code>gettext</code> es una serie de programas
  que se encargan de rastrear los fuentes buscando cadenas a traducir y
  actualizarlas cuando cambian. Existen programas con interfaces gr谩ficas para
  facilitar esta tarea, tal como
  <a title="poEdit" target="_blank" href="http://www.poedit.net/">poEdit</a>,
  que est谩 disponible para Linux, Macintosh y Windows y, obviamente,
  internacionalizado, aunque tambi茅n est谩n los comandos de l铆nea que existen en
  todas las plataformas Linux (aunque pueden no estar instalados por defecto) y
  tambi茅n hay versiones para Windows (<a
    title="gnuwin32 en SourceForge"
    target="_blank"
    href="http://gnuwin32.sourceforge.net/packages/gettext.htm"
    >gnuwin32</a
  >).
</p>
<p>El proceso, resumido, es el siguiente:</p>
<p>
  1) se extraen las cadenas a traducir con el programa
  <code>xgettext</code>:
</p>
<p>
  <code
    >xgettext *.php --output=index.pot --keyword=__ --from-code=ISO-8859-1</code
  >
</p>
<p>
  En todos los casos he usado las versiones largas de las opciones para que sean
  m谩s claras. A <code>xgettext</code> se le indica el o los fuentes de los que
  extraer las cadenas. Se le debe indicar el archivo de salida o redireccionar
  de la salida est谩ndar, el set de caracteres de los fuentes y, en nuestro caso,
  dado que hemos usado el nombre de funci贸n <code>__()</code> en lugar de
  <code>_()</code> se le debe indicar expresamente que busque este nombre de
  funci贸n. El programa reconoce el lenguaje de los fuentes por su extensi贸n e
  interpreta la sint谩xis seg煤n se trate, pero si se hubiera usado alguna
  extensi贸n que no reconociera, se le puede indicar expresamente.
</p>
<p>
  En este caso la salida ha sido un archivo <code>.pot</code>, extensi贸n que
  corresponde a un <em>`template麓</em> o `modelo麓 de la traducci贸n. Es habitual
  entregar este archivo de modelo como parte de una aplicaci贸n para que el
  traductor disponga de un original limpio a partir del cual comenzar su
  trabajo.
</p>
<p>2) Se genera un archivo de traducci贸n a partir del modelo:</p>
<p>
  <code>msginit --input=index.pot --output=en.po --locale=en</code>
</p>
<p>
  Este programa simplemente toma el archivo <code>.pot</code> que se le indica y
  genera un archivo <code>.po</code> para la localizaci贸n que se indica.
  Completa varios de los campos con datos que obtiene del sistema, por ejemplo,
  el nombre de usuario, la fecha de la traducci贸n y pone como traducci贸n el
  mismo texto que el original. El traductor puede tanto comenzar a partir del
  archivo <code>.pot</code> o del <code>.po</code> seg煤n prefiera.
</p>
<p>
  3) Traducci贸n. Esta se puede hacer con cualquier editor de texto simple.
  Existen macros para EMACS y hay IDEs que tienen modos de edici贸n espec铆ficos
  para este tipo de archivo. Aplicaciones como
  <a title="poEdit" target="_blank" href="http://www.poedit.net/">poEdit</a>
  disponen de su propio editor. Este programa en particular permite guardar una
  base de datos de traducciones de tal manera que en sucesivas traducciones
  puede intentar por s铆 solo traducir parte de los textos.
</p>
<p>
  De todas formas, el proceso es simple, el texto tras la palabra clave msgid es
  el original, el que sigue a msgstr es la traducci贸n. Para facilitar la tarea,
  los comentarios que preceden a cada cadena muestran el fuente y n煤mero de
  l铆nea en que ha encontrado esta cadena. El programa
  <code>xgettext</code> se encarga de identificar cadenas duplicadas por s铆
  mismo.
</p>
<p>4) Compilaci贸n:</p>
<p><code>msgfmt en.po --output-file=en.mo</code></p>
<p>
  Esta es la parte m谩s simple del proceso, compilarlo implica llamar a
  <code>msgfmt</code>, indicarle el nombre del archivo de entrada y el de
  salida.
</p>
<p>
  Esta 煤ltima etapa puede automatizarse f谩cilmente dentro de un archivo
  <code>makefile</code>, no as铆 las primeras. En particular, llamar a
  <code>msginit</code> una segunda vez destruir铆a el archivo de traducciones ya
  hecho. El paquete dispone de un mecanismo de actualizaci贸n a trav茅s del
  programa <code>msgmerge</code>. El proceso de actualizaci贸n es similar al ya
  descripto, comenzando por el punto 1 hasta el 4, excepto que en lugar del paso
  2 anterior se utiliza el comando siguiente:
</p>
<p><code>msgmerge --update en.po index.pot</code></p>
<p>
  El comando <code>msgmerge</code> lee tanto el <code>.pot</code> como el
  <code>.po</code> y actualiza este 煤ltimo sin da帽ar las traducciones ya
  presentes.
</p>
<p>
  Advi茅rtase que solo es necesario un 煤nico archivo de traducciones para toda
  una aplicaci贸n, no es necesaria un archivo asociado a cada fuente, de all铆 que
  para el modelo us茅 el nombre <code>index.pot</code>, adoptando index como
  predeterminado, aunque no esto no es necesario.
</p>
<p>
  Gettext tiene varias otras facilidades que no he mencionado, como ser el
  manejo de traducciones ambiguas (<em>fuzzy</em>), plurales (permite ofrecer
  distintas traducciones seg煤n el n煤mero de 铆tems que se le indiquen) y
  m煤ltiples dominios, lo cual es indispensable cuando se utilizan paquetes de
  diferentes or铆genes o <em>`plugins麓</em>, cada uno con sus conjunto de
  traducciones independientes. Para esto se recomienda ver la documentaci贸n
  original.
</p>
<p>
  Viene de:
  <a
    title="Enlace permanente: Internacionalizaci贸n y localizaci贸n: usando gettext()"
    rel="bookmark"
    href="2007/01/16/internacionalizacion-y-localizacion-usando-gettext.html"
    >Internacionalizaci贸n y localizaci贸n: usando gettext()</a
  >
</p>
<p>
  Contin煤a en:
  <a
    title="Enlace permanente: Internacionalizaci贸n y localizaci贸n: bases de datos"
    rel="bookmark"
    href="2007/01/17/internacionalizacion-y-localizacion-bases-de-datos.html"
    >Internacionalizaci贸n y localizaci贸n: bases de datos</a
  >
</p>
<p>
  Indice:
  <a
    title="Enlace permanente: Internacionalizaci贸n y Localizaci贸n: 铆ndice"
    rel="bookmark"
    href="2007/01/17/internacionalizacion-y-localizacion-indice.html"
    >Internacionalizaci贸n y Localizaci贸n: 铆ndice</a
  >
</p>

          </div>
          <footer class="post-footer">
    <div class="next-prev-links">
      <a  class="prev-link" href="2007/01/16/internacionalizacion-y-localizacion-usando-variables.html"><div class="triangle-left"></div> Anterior</a>
      <a  class="next-link" href="2007/01/16/internacionalizacion-y-localizacion-usando-gettext.html">Siguiente <div class="triangle-right"></div></a>
    </div> </footer>
          <a class="u-url" href="/blog2007/01/16/internacionalizacion-y-localizacion-usando-php-gettext.html" hidden></a>
        </article>
      </div>
    </main>
    <footer class="site-footer h-card">
      <data class="u-url" href="/blog"></data>

      <div class="wrapper">
        <h2 class="footer-heading">Comentarios</h2>

        <div class="footer-col-wrapper">
          <div class="footer-col footer-col-1">
            <ul class="contact-list">
              <li class="p-name">Comentarios</li>
              <li>
                <a class="u-email" href="mailto:satyam@satyam.com.ar"
                  >satyam@satyam.com.ar</a
                >
              </li>
            </ul>
          </div>

          <div class="footer-col footer-col-2">
            <ul class="social-media-list"></ul>
          </div>

          <div class="footer-col footer-col-3">
            <p>Comentarios, viajes, ideas e historias</p>
          </div>
        </div>
      </div>
    </footer>
    
  </body>
</html>
