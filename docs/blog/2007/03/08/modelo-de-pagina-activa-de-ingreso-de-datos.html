<!DOCTYPE html>
<html lang="es">
  <head>
    <!--Source file: 2007-03-08-modelo-de-pagina-activa-de-ingreso-de-datos.html-->
    <meta charset="utf-8" />
    <base href="/blog/" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Modelo de p√°gina activa de ingreso de datos | Comentarios</title>
    <meta property="og:title" content="Modelo de p√°gina activa de ingreso de datos" />
    <meta property="og:locale" content="es-ES" />
    <meta name="description" content="

 Para aplicaciones de cierta envergadura, el uso de `frameworks` de
 desarrollo o motores de `templates` es altamente recomendado, pero
 para muchas aplicaciones peque√±as o para las p√°ginas de mantenimiento de
 tablas, que pueden no ser particularmente importantes, un modelo m√°s simple es
 m√°s que suficiente. Comentar√© un modelo simple, cuyo c√≥digo se puede ver en
 esta p√°gina. y el resultado en
 esta otra. El ejemplo no funciona del todo pues para ello requerir√≠a una base de datos
 real y no la tiene. Para seguir este comentario har√© referencia a los n√∫meros
 de l√≠nea en la p√°gina referida (indicando el n√∫mero de l√≠nea entre corchetes)
 por ello es conveniente tener ambas ventanas abiertas una al lado de la otra.

" />
    <meta property="og:description" content="

 Para aplicaciones de cierta envergadura, el uso de `frameworks` de
 desarrollo o motores de `templates` es altamente recomendado, pero
 para muchas aplicaciones peque√±as o para las p√°ginas de mantenimiento de
 tablas, que pueden no ser particularmente importantes, un modelo m√°s simple es
 m√°s que suficiente. Comentar√© un modelo simple, cuyo c√≥digo se puede ver en
 esta p√°gina. y el resultado en
 esta otra. El ejemplo no funciona del todo pues para ello requerir√≠a una base de datos
 real y no la tiene. Para seguir este comentario har√© referencia a los n√∫meros
 de l√≠nea en la p√°gina referida (indicando el n√∫mero de l√≠nea entre corchetes)
 por ello es conveniente tener ambas ventanas abiertas una al lado de la otra.

" />
    <link rel="canonical" href="http://www.satyam.com.ar/blog/2007/03/08/modelo-de-pagina-activa-de-ingreso-de-datos.html" />
    <meta property="og:url" content="http://www.satyam.com.ar/blog/2007/03/08/modelo-de-pagina-activa-de-ingreso-de-datos.html" />
    <meta property="og:site_name" content="Comentarios" />
    <meta property="og:type" content="article" />
    <meta property="article:published_time" content="2007-03-08T00:00:00+01:00" />
    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Modelo de p√°gina activa de ingreso de datos" />
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "dateModified": "2007-03-08T00:00:00+01:00",
        "datePublished": "2007-03-08T00:00:00+01:00",
        "description": "

 Para aplicaciones de cierta envergadura, el uso de `frameworks` de
 desarrollo o motores de `templates` es altamente recomendado, pero
 para muchas aplicaciones peque√±as o para las p√°ginas de mantenimiento de
 tablas, que pueden no ser particularmente importantes, un modelo m√°s simple es
 m√°s que suficiente. Comentar√© un modelo simple, cuyo c√≥digo se puede ver en
 esta p√°gina. y el resultado en
 esta otra. El ejemplo no funciona del todo pues para ello requerir√≠a una base de datos
 real y no la tiene. Para seguir este comentario har√© referencia a los n√∫meros
 de l√≠nea en la p√°gina referida (indicando el n√∫mero de l√≠nea entre corchetes)
 por ello es conveniente tener ambas ventanas abiertas una al lado de la otra.

",
        "headline": "Modelo de p√°gina activa de ingreso de datos",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "http://www.satyam.com.ar/blog/2007/03/08/modelo-de-pagina-activa-de-ingreso-de-datos.html"
        },
        "url": "http://www.satyam.com.ar/blog/2007/03/08/modelo-de-pagina-activa-de-ingreso-de-datos.html"
      }
    </script>
    <link rel="stylesheet" href="assets/css/style.css" />
    <link
      type="application/atom+xml"
      rel="alternate"
      href="feed.xml"
      title="Comentarios"
    />
  </head>
  <body>
    <header class="site-header" role="banner">
      <div class="wrapper">
        <a class="site-title" rel="author" href="index.html">Comentarios</a>
        <nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path
                  d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"
                />
              </svg>
            </span>
          </label>

          <div class="trigger">
            
  <a class="page-link" href="../" title="Home page">Home</a>
  <a class="page-link" href="posts.html" title="Art√≠culos por fecha">Archivo</a>
  <a class="page-link" href="categories.html" title="Art√≠culos por etiqueta">
    Etiquetas
  </a>

            <form
              id="searchform"
              method="get"
              action="https://www.google.com/search"
              target="_blank"
            >
              <input type="text" name="q" id="s" size="15" />
              <input type="submit" name="submit" value="üîç" />
              <input type="hidden" name="as_sitesearch" value="satyam.com.ar" />
            </form>
          </div>
        </nav>
      </div>
    </header>
    <main class="page-content" aria-label="Content" lang="es-ES">
      <div class="wrapper">
        <article
          class="post h-entry"
          itemscope
          itemtype="http://schema.org/BlogPosting"
        >
          <header class="post-header">
            <h1 class="post-title p-name" itemprop="name headline">
              Modelo de p√°gina activa de ingreso de datos
            </h1>
            <div class="post-meta">
  <div class="date-published">
    Publicado el: 
    <time  datetime="2007-03-08T00:00:00+01:00" itemprop="datePublished">
      8 / Marzo / 2007
    </time>
  </div>
  <div class="post-cats">Archivado bajo: <a
href="categories/#Tecnologia_Programacion"
rel="category tag"
>
Tecnolog√≠a / Programaci√≥n
</a>
</div>
</div>

          </header>

          <div
            class="post-content e-content "
            itemprop="articleBody"
          >
            
<p>
  Para aplicaciones de cierta envergadura, el uso de `<em>frameworks</em>` de
  desarrollo o motores de `<em>templates</em>` es altamente recomendado, pero
  para muchas aplicaciones peque√±as o para las p√°ginas de mantenimiento de
  tablas, que pueden no ser particularmente importantes, un modelo m√°s simple es
  m√°s que suficiente. Comentar√© un modelo simple, cuyo c√≥digo se puede ver en
  <a
    title="Modelo de p√°gina activa"
    href="http://satyam.com.ar/int/ShowSource.php?title=Modelo+de+pagina+activa&file=modelo.php"
    target="_blank"
    rel="noopener noreferrer"
    >esta p√°gina</a
  >. y el resultado en
  <a
    title="ejemplo"
    href="/int/modelo.php"
    target="_blank"
    rel="noopener noreferrer"
    >esta otra</a
  >. El ejemplo no funciona del todo pues para ello requerir√≠a una base de datos
  real y no la tiene. Para seguir este comentario har√© referencia a los n√∫meros
  de l√≠nea en la p√°gina referida (indicando el n√∫mero de l√≠nea entre corchetes)
  por ello es conveniente tener ambas ventanas abiertas una al lado de la otra.
</p>
<span class="more"></span>
<p>
  Mucho del c√≥digo que muestro es de uso general y por lo tanto apropiado para
  ubicar en uno o m√°s archivos que se incluir√°n en la p√°gina mediante la
  instrucci√≥n
  <a
    title="Manual de PHP: funci√≥n include()"
    href="http://www.php.net/manual/es/function.include.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>include</code></a
  >. No lo estoy haciendo en este ejemplo para que el lector pueda ver todo en
  un solo vistazo sin andar saltando de un archivo al otro. De hecho el √∫nico
  <a
    title="Manual de PHP: funci√≥n include()"
    href="http://www.php.net/manual/es/function.include.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>include</code></a
  >
  que muestro [2] es a
  <a title="BuildSql.php" href="2007/01/21/arma-sql.html"
    ><code>BuildSql.php</code></a
  >
  cuya funcionalidad comento en otro
  <a title="BuildSql.php" href="2007/01/21/arma-sql.html">art√≠culo</a>.
</p>
<p>
  Por ejemplo, la p√°gina hace uso de una conexi√≥n a una base de datos que se ha
  abierto en alg√∫n lugar que no se muestra. Tambi√©n es frecuente que la parte
  variable de la aplicaci√≥n est√© rodeada de un marco con informaci√≥n general del
  sitio, logotipo de la empresa, el men√∫ de navegaci√≥n y otras cosas que son
  comunes a todas las p√°ginas del sitio. Todo esto convendr√° que est√© en
  archivos de
  <a
    title="Manual de PHP: funci√≥n include()"
    href="http://www.php.net/manual/es/function.include.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>include</code></a
  >.
</p>
<p>
  Las funciones de validaci√≥n de datos tambi√©n son excelentes candidatas a
  residir en archivos de
  <a
    title="Manual de PHP: funci√≥n include()"
    href="http://www.php.net/manual/es/function.include.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>include</code></a
  >. En el ejemplo, he incorporado su c√≥digo directamente a la p√°gina para
  mostrar c√≥mo pueden hacerse. Lo mejor es tener una biblioteca de funciones de
  validaci√≥n en un
  <a
    title="Manual de PHP: funci√≥n include()"
    href="http://www.php.net/manual/es/function.include.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>include</code></a
  >
  externo, esta p√°gina s√≥lo cumple un fin did√°ctico.
</p>
<p>
  La p√°gina permite editar una simple tabla compuesta de 4 campos,
  <code>IdDatos</code>, un entero que es la clave principal de la tabla,
  <code>Nombre</code>, un <em>varchar</em>, <code>FechaNacimiento</code>, una
  fecha y <code>NumDependientes</code>, un entero.
</p>
<p>
  A esta p√°gina se puede llegar de dos formas. Si en el URL se incluye un
  argumento <code>id_datos</code>, es que se desea ver y/o editar el registro
  cuya clave se indica. Si no se incluye un <code>id_datos</code> o este es
  cero, es que se desea agregar un nuevo registro.
</p>
<p>
  En primer lugar, [6-15] se lee y valida este argumento. Esta t√©cnica se
  utiliza con variaciones con el resto de los datos. Salvo que los espacios en
  blanco en los extremos fueran importantes, lo primero [6] ser√° eliminarlos con
  <a
    title="Manual de PHP: funci√≥n trim()"
    href="http://www.php.net/manual/es/function.trim.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>trim()</code></a
  >. Luego [7], se verifica la longitud de lo que queda con
  <a
    title="Manual de PHP: funci√≥n strlen()"
    href="http://www.php.net/manual/es/function.strlen.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>strlen()</code></a
  >, lo cual permite controlar datos que sean obligatorios y mostrar un mensaje,
  si correspondiere. En este caso, si no hubiera un argumento
  <code>id_datos</code>, simplemente se lo supone cero [14]. Dado que el campo
  <code>IdDatos</code> es un autonum√©rico y que estos comienzan en 1, 0 es una
  obvia indicaci√≥n de que no nos referimos a un registro existente sino uno
  nuevo que todav√≠a no tiene <code>IdDatos</code>.
</p>
<p>
  Usamos expresiones regulares para validar los datos. Funciones como
  <a
    title="Manual de PHP: funci√≥n intval()"
    href="http://www.php.net/manual/es/function.intval.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>intval()</code></a
  >
  o
  <a
    title="Manual de PHP: funci√≥n floatval()"
    href="http://www.php.net/manual/es/function.floatval.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>floatval()</code></a
  >
  interpretan todo lo que encuentran como num√©rico hasta el primer car√°cter que
  no lo sea. Por ello, no son suficientes para detectar que ¬¥12 de octubre¬¥ es
  un texto, no un n√∫mero, pues cualquiera de ellas lee y convierte el 12 e
  ignora el resto. Otro peligro de
  <a
    title="Manual de PHP: funci√≥n intval()"
    href="http://www.php.net/manual/es/function.intval.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>intval()</code></a
  >
  es que si la cadena a evaluar comienza en 0, la interpretar√° como octal, dando
  resultados inesperados. Es importante [9] agregar el segundo par√°metro que es
  la base de conversi√≥n para salvar este peligro.
</p>
<p>
  En caso de √©xito, este segmento devuelve en
  <code>$id_datos</code> el valor convertido a entero [9], un 0 si no estuviera
  presente [14] o sale por error [11] si fuera inv√°lido. A diferencia de los
  otros datos en que se muestra un mensaje de error al usuario, este dato s√≥lo
  puede venir a trav√©s de enlaces desde otras p√°ginas por lo tanto no es un
  error que el usuario pudiera salvar. El error del que hablamos no es
  simplemente un n√∫mero de registro que pudiera haber sido borrado (que es
  salvable) sino un argumento <code>id_datos</code> que contenga caracteres
  no-num√©ricos, lo que se√±ala un posible intento de jugar con el URL para romper
  la aplicaci√≥n, lo cual no es aceptable y conviene impedir que el operador
  pueda continuar m√°s all√°.
</p>
<p>
  En [18] preguntamos si hay un argumento
  <code>'submit'</code> con valor <code>'Aceptar'</code>. Esto es indicio que a
  esta p√°gina se lleg√≥ al pulsar el bot√≥n <code>Aceptar</code> al pie del
  formulario. En este caso, leemos tambi√©n el resto de las variables, comenzando
  por <code>Nombre</code>.
</p>
<p>
  La opci√≥n
  <code
    ><a
      title="Manual de PHP: opci√≥n magic_quotes_gpc"
      href="http://www.php.net/manual/es/security.magicquotes.php"
      target="phpmanual"
      rel="noopener noreferrer"
      >magic_quotes_gpc</a
    ></code
  >
  del php.ini, que est√° en <code>on</code> por defecto, agrega la barra
  invertida por delante de cualquier ap√≥strofe o comilla, por lo que lo primero
  [20] es eliminar los blancos en los extremos y sacar estas barras con la
  funci√≥n
  <a
    title="Manual de PHP: funci√≥n stripslashes()"
    href="http://www.php.net/manual/es/function.stripslashes.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>stripslashes()</code></a
  >. La raz√≥n por la que PHP agrega estas barras es salvar a programadores
  inexpertos de pasar datos sin validar a la base de datos y quedar expuestos a
  lo que se denomina `SQL injection¬¥ o dejar comillas desapareadas en las
  instrucciones SQL. Aqu√≠ no s√≥lo estamos validando los datos, como corresponde,
  sino que tambi√©n la funci√≥n
  <a title="BuildSql.php" href="2007/01/21/arma-sql.html"
    ><code>BuildSql()</code></a
  >
  comentada anteriormente salva las comillas y ap√≥strofes antes de grabar.
</p>
<p>
  En [21] controlamos que no est√© vac√≠a y en [22] controlamos que contenga s√≥lo
  caracteres aceptables, incluidos letras acentuadas, ap√≥strofes (D¬¥El√≠a,
  O¬¥Higgins) o guiones. Esta lista se podr√° ampliar o limitar a voluntad. Dado
  que el valor es de por si una cadena de caracteres, si valida, no hay nada m√°s
  que hacer. Si no valida, entonces en [25] preparamos el mensaje de error. Otro
  tanto ocurre en [28] en el caso de que el campo hubiera estado en blanco.
</p>
<p>
  Los errores no los mostraremos en el momento por dos razones. Todav√≠a no hemos
  enviado el encabezamiento de la p√°gina al navegador, por lo que los mensajes
  quedar√≠an fuera de contexto y no enviaremos estos encabezados hasta m√°s
  adelante [71] por razones que ya comentaremos. Por otro lado, este esquema nos
  permitir√° mostrar los errores junto al campo en error, lo cual ser√° m√°s √∫til
  al usuario.
</p>
<p>
  Para los errores, tenemos reservada una variable
  <code>$errores</code>, que inicializamos en [4] con un <em>array</em> en
  blanco. Los errores de cada campo los agregaremos a este <em>array</em> usando
  el nombre del campo como clave, seg√∫n se ve en [25] y [28]. Adicionalmente,
  previendo la posibilidad de que hubiera m√°s de un error para un mismo campo,
  agregamos el par de corchetes vac√≠os para que el mensaje se agregue sobre una
  posible lista de errores para ese mismo campo. Aunque en este ejemplo no se
  usa, reservamos el elemento <code>$errores[null]</code> para mensajes de error
  gen√©ricos que no est√©n asociados a ning√∫n campo.
</p>
<p>
  En el caso de la fecha [31-40], usamos la misma funci√≥n
  <a
    title="Manual de PHP: funci√≥n preg_match()"
    href="http://www.php.net/manual/es/function.preg-match.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>preg_match()</code></a
  >
  no s√≥lo para validar sino tambi√©n para separar las partes (d√≠a/mes/a√±o)
  permitiendo usar indistintamente barras o guiones para separar las partes.
  Como ya se comentara, en un caso real, todas estas funciones de validaci√≥n y
  conversi√≥n deber√≠an estar en un
  <a
    title="Manual de PHP: funci√≥n include()"
    href="http://www.php.net/manual/es/function.include.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>include</code></a
  >
  y esta en particular, como tambi√©n las funciones de validaci√≥n y conversi√≥n de
  importes monetarios deber√°n adecuarse al
  <em>`locale¬¥</em>, seg√∫n comentara en un
  <a
    title="setlocale() y otras funciones"
    href="2007/01/17/internacionalizacion-y-localizacion-setlocale-y-otras-funciones.html"
    >art√≠culo previo</a
  >. En el caso de las fechas, la funci√≥n
  <a
    title="Manual de PHP: funci√≥n nl_langinfo()"
    href="http://www.php.net/manual/es/function.nl-langinfo.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>nl_langinfo(D_T_FMT)</code></a
  >
  nos dar√° una cadena de la que podemos deducir el orden de las partes
  (dd/mm/aaaa, mm/dd/aaaa o aaaa/mm/dd) y en el caso de importes monetarios, la
  funci√≥n
  <code
    ><a
      title="Manual de PHP: funci√≥n localeconv()"
      href="http://www.php.net/manual/es/function.localeconv.php"
      target="phpmanual"
      rel="noopener noreferrer"
      >localeconv()</a
    ></code
  >
  nos permitir√° tambi√©n armar la expresi√≥n regular correcta.
</p>
<p>
  Salvo <code>$id_datos</code>, el resto de los datos los hemos puesto como
  obligatorios y mostramos mensajes de error al efecto. En caso de no serlo,
  basta cambiar la generaci√≥n del mensaje de error por una asignaci√≥n a la
  variable interna el valor predeterminado para el campo o asegurarse de dejarla
  en blanco, cero o <code>null</code>, seg√∫n se quiera grabar en la base de
  datos. Yo soy partidario del uso de <code>null</code> en la base de datos para
  indicar la ausencia de informaci√≥n, pero como al mostrar una variable que
  contiene <code>null</code> ocasionalmente se puede ver el texto
  <code>'null'</code>, la funci√≥n
  <a title="BuildSql.php" href="2007/01/21/arma-sql.html"
    ><code>BuildSql()</code></a
  >
  provee el modificador <code>n</code> (por ejemplo <code>?ns</code> en lugar de
  simplemente <code>?s</code>) para grabar los ceros o cadenas vac√≠as como
  <code>null</code> en la base de datos.
</p>
<p>
  Es un buen momento para resaltar algo importante. Mi criterio es que todos los
  datos, adem√°s de validarse, deben convertirse al formato nativo apenas se
  reciben y s√≥lo deben formatearse a la salida. La fecha es el caso en que con
  m√°s frecuencia veo tropezarse a los novatos. Muchas veces, reciben la fecha
  del campo del formulario y as√≠ como est√°, la graban en la base de datos en un
  campo de texto. Al poco tiempo llegan a la lista de correos de PHP preguntando
  c√≥mo pueden hacer para ordenar los registros por fechas o seleccionar los
  registros del √∫ltimo mes. Para ese entonces es tarde. SQL dispone de una
  enorme variedad de funciones para operar y seleccionar registros sobre fechas
  y aunque PHP es un poco mezquino, hay muchas bibliotecas de funciones para
  salvar esta carencia de funciones para manipular fechas. Ninguna de estas
  funciones puede operar sobre una fecha expresada como una cadena de
  caracteres, con variedad de separadores, con ceros para completar los d√≠as y
  meses a dos d√≠gitos o no, con los a√±os en 2 √≥ 4 d√≠gitos. En resumen, el dato
  carece de valor sem√°ntico que permita operar sobre √©l. Es la misma raz√≥n por
  la que a las cadenas de caracteres les aplico
  <a
    title="Manual de PHP: funci√≥n stripslashes()"
    href="http://www.php.net/manual/es/function.stripslashes.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>stripslashes()</code></a
  >
  y a los importes los convierto a <code>float</code>.
</p>
<p>
  Reitero: Los datos siempre se deben validar y convertir al formato nativo
  apenas se reciben y se deben formatear reci√©n al enviarlos fuera, ya sea al
  navegador o a la base de datos. En el caso de la base de datos, la funci√≥n
  <a title="BuildSql.php" href="2007/01/21/arma-sql.html"
    ><code>BuildSql()</code></a
  >
  se encarga de esto.
</p>
<p>
  Volviendo al modelo, en la l√≠nea [53] controlamos que a√∫n no haya errores y si
  efectivamente no los hay, procedemos a grabar la informaci√≥n. En primer lugar
  vemos si
  <code>$id_datos</code> est√° o no en cero. Si <code>$id_datos</code> es cero es
  un alta de registro, si es distinto de cero, es una actualizaci√≥n. MySql
  dispone de la instrucci√≥n <code>REPLACE</code> que hace irrelevante la
  diferencia, pero esa instrucci√≥n no es est√°ndar de SQL por lo cual mejor
  evitarla.
</p>
<p>
  En [55] utilizo la funci√≥n
  <a title="BuildSql.php" href="2007/01/21/arma-sql.html"
    ><code>BuildSql()</code></a
  >
  para armar la instrucci√≥n en <code>$sql</code>, luego procedo a ejecutarla
  sobre la base de datos [57]. En producci√≥n, acostumbro a eliminar el paso
  intermedio de la variable <code>$sql</code>, simplemente hago
  <code>$mysql_query(BuildSql( ....))</code>, pero en las primeras etapas
  conviene disponer el texto de la instrucci√≥n en <code>$sql</code> pues si
  hubiera error, es m√°s f√°cil para ver qu√© ocurri√≥.
</p>
<p>
  Es <strong>IMPRESCINDIBLE</strong> controlar el resultado de
  <a
    title="Manual de PHP: funci√≥n mysql_query()"
    href="http://www.php.net/manual/es/function.mysql-query.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>mysql_query()</code></a
  >
  tras su ejecuci√≥n. Un buen n√∫mero de mensajes en la lista de PHP se ahorrar√≠an
  si los programadores inexpertos o descuidados adoptaran esta norma. Hasta
  escrib√≠ un
  <a
    title="Programaci√≥n Bal√≠stica"
    href="2006/06/29/programacion-balistica.html"
    >art√≠culo</a
  >
  al respecto, lo llamo Programaci√≥n Bal√≠stica, escribes el programa y lo
  disparas, esperando que acierte en el blanco pero, al igual que un proyectil
  bal√≠stico, una vez que abandona el ca√±√≥n, ya no tienes ning√∫n control sobre el
  mismo. Luego de d√≠as de arrancarte los pelos, consultas a la lista de PHP para
  que te solucionen el problema que tu podr√≠as haber detectado desde el inicio.
</p>
<p>
  El uso del operador <code>or</code> en este caso es bastante singular. Es un
  viejo truco pero, atenci√≥n, no funciona en todos los lenguajes, en Visual
  Basic no funciona y en algunas versiones de Pascal tampoco. El caso es que el
  operador <code>or</code> devuelve <code>verdadero</code> si cualquiera de sus
  operandos es <code>verdadero</code>, por lo tanto, si el primer operando, en
  este caso, la funci√≥n
  <a
    title="Manual de PHP: funci√≥n mysql_query()"
    href="http://www.php.net/manual/es/function.mysql-query.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>mysql_query()</code></a
  >
  devuelve un valor no-<code>falso</code>, el int√©rprete no se molesta siquiera
  en evaluar el segundo operando, en este caso la funci√≥n
  <a
    title="Manual de PHP: funci√≥n die()"
    href="http://www.php.net/manual/es/function.die.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>die()</code></a
  >, pero, si el primer operando da <code>falso</code>, que en el caso de
  <a
    title="Manual de PHP: funci√≥n mysql_query()"
    href="http://www.php.net/manual/es/function.mysql-query.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>mysql_query()</code></a
  >
  indica un error, entonces el operador <code>or</code> se ve forzado a evaluar
  el segundo operando, en este caso la funci√≥n
  <a
    title="Manual de PHP: funci√≥n die()"
    href="http://www.php.net/manual/es/function.die.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>die()</code></a
  >. Esta funci√≥n, en realidad, no devuelve ning√∫n valor, de hecho, no retorna
  pues termina la ejecuci√≥n del <em>script</em>, por lo tanto el operador
  <code>or</code> no podr√° devolver nada, pero para ese entonces no importa. El
  operador <code>or</code> est√°, en este caso, actuando m√°s como una estructura
  de control que como un operador, pues lo que importa es c√≥mo afecta la
  secuencia de ejecuci√≥n de las instrucciones, en este caso, si el
  <a
    title="Manual de PHP: funci√≥n die()"
    href="http://www.php.net/manual/es/function.die.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>die()</code></a
  >
  se ejecuta o no. Lo mismo se podr√≠a hacer con un
  <code>if</code>. La ventaja que le veo a esta sintaxis es que el
  <code>or die()</code> queda como un condimento al final del
  <a
    title="Manual de PHP: funci√≥n mysql_query()"
    href="http://www.php.net/manual/es/function.mysql-query.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>mysql_query()</code></a
  >
  que es lo fundamental. Si encierro el
  <a
    title="Manual de PHP: funci√≥n mysql_query()"
    href="http://www.php.net/manual/es/function.mysql-query.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>mysql_query()</code></a
  >
  dentro del <code>if</code>, el <code>if</code> parece tomar m√°s importancia
  que el
  <a
    title="Manual de PHP: funci√≥n mysql_query()"
    href="http://www.php.net/manual/es/function.mysql-query.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>mysql_query()</code></a
  >
  y me distrae de la secuencia normal de ejecuci√≥n del programa para llamarme la
  atenci√≥n sobre la recuperaci√≥n de un eventual error.
</p>
<p>
  Es en esta llamada a la funci√≥n
  <a
    title="Manual de PHP: funci√≥n die()"
    href="http://www.php.net/manual/es/function.die.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>die()</code></a
  >
  donde la variable <code>$sql</code> es de gran utilidad pues la funci√≥n
  <a
    title="Manual de PHP: funci√≥n mysql_error()"
    href="http://www.php.net/manual/es/function.mysql-error.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>mysql_error()</code></a
  >
  nos indica el tipo de error, pero no nos muestra la instrucci√≥n que ha
  generado el error: para eso mostramos <code>$sql</code>. Nuevamente, en este
  caso usamos la funci√≥n
  <a
    title="Manual de PHP: funci√≥n die()"
    href="http://www.php.net/manual/es/function.die.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>die()</code></a
  >
  en lugar de mostrar un error al usuario pues estos errores s√≥lo ocurren en dos
  circunstancias. La primera es cuando se est√° en desarrollo y se ha cometido un
  error de sintaxis en la instrucci√≥n SQL. Lo mejor es corregir el error antes
  de seguir adelante con las pruebas. La funci√≥n
  <a title="BuildSql.php" href="2007/01/21/arma-sql.html"
    ><code>BuildSql()</code></a
  >
  salva la mayor√≠a de los errores que potencialmente se podr√≠an producir por
  datos inv√°lidos, que son sobre los cuales el usuario podr√≠a tener influencia
  llegada a la etapa de producci√≥n. Por esto es tambi√©n que llegado a la etapa
  de producci√≥n, el paso intermedio de guardar la instrucci√≥n en
  <code>$sql</code> se puede eliminar. La segunda circunstancia, ya en
  producci√≥n, es cuando se cae la base de datos, en cuyo caso de poco sirve
  querer continuar.
</p>
<p>
  En [58] uso la funci√≥n
  <a
    title="Manual de PHP: funci√≥n header()"
    href="http://www.php.net/manual/es/function.header.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>header()</code></a
  >
  para hacer que el int√©rprete env√≠e al navegador un encabezado de tipo
  <code>Location</code>, lo cual produce una redirecci√≥n. Este es el truco para
  evitar insertar m√∫ltiples registros cuando el operador pulsa
  <code>F5</code> repetidas veces o hace clic sobre el bot√≥n de refrescar. Esta
  t√©cnica la he comentado en otro
  <a
    title="Evitar m√∫ltiples inserciones con F5"
    href="2007/01/18/como-evitar-duplicar-registros-al-hacer-refrescar-f5-en-el-navegador.html"
    >art√≠culo</a
  >, as√≠ que no la desarrollar√© aqu√≠. Dado que no se pueden enviar
  <em>headers</em> al navegador una vez que se ha comenzado a enviar texto,
  hasta ahora nos hemos abstenido de hacerlo. Esta es una de las razones para no
  haber mostrado los mensajes de error que hubieramos encontrado.
</p>
<p>
  Baste decir que en este caso agrego al <code>URL</code> de esta misma p√°gina
  (que genero din√°micamente para hacerla portable) dos argumentos,
  <code>confirma</code> recibe un entero distinto de cero que simplemente indica
  el texto del mensaje de error a mostrar. El segundo argumento,
  <code>$id_datos</code>, es la referencia al registro actualizado, para poder
  seguir operando sobre √©l. El n√∫mero y tipo de estos argumentos es arbitrario,
  pero es necesario que haya al menos un argumento (en este caso
  <code>confirma</code>) que permita diferenciar un <code>URL</code> de
  confirmaci√≥n de uno de consulta o de modificaci√≥n (argumento
  <code>submit</code>). Convendr√° agregar los suficientes argumentos para
  proveer al usuario de un mensaje significativo o, alternativamente, si ya se
  estuvieran usando sesiones, se puede guardar la informaci√≥n en variables de
  sesi√≥n en <code>$_SESSION</code>.
</p>
<p>
  En el caso de ser una inserci√≥n de nuevo registro, hacemos lo mismo [60-64]
  salvo que en [63] leemos el valor de la clave autonum√©rica generada, para usar
  en el mensaje de confirmaci√≥n. En ambos casos, en [66] salimos del
  <em>script</em>. Las funciones
  <a
    title="Manual de PHP: funci√≥n exit()"
    href="http://www.php.net/manual/es/function.exit.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>exit()</code></a
  >
  y
  <a
    title="Manual de PHP: funci√≥n die()"
    href="http://www.php.net/manual/es/function.die.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>die()</code></a
  >
  son sin√≥nimos, pero yo prefiero usar
  <a
    title="Manual de PHP: funci√≥n die()"
    href="http://www.php.net/manual/es/function.die.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>die()</code></a
  >
  para las salidas catastr√≥ficas y
  <a
    title="Manual de PHP: funci√≥n exit()"
    href="http://www.php.net/manual/es/function.exit.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>exit()</code></a
  >
  para las intencionales.
</p>
<p>
  En [71], finalmente, comenzamos con el contenido de la p√°gina. La declaraci√≥n
  de tipo de documento es conveniente pues permite validar el documento con
  <a
    title="HTML Tidy en SourceForge"
    href="http://tidy.sourceforge.net/"
    target="_blank"
    rel="noopener noreferrer"
    >HTML Tidy</a
  >
  y asegura un comprotamiento m√°s predecible en el navegador. Para ser concreto,
  el Internet Explorer 7 tiene dos modos de funcionamiento, uno en que reproduce
  algunas incompatibilidades de versiones pasadas (IE6 y previas) y otro en que
  se ajusta m√°s a la norma, y esto lo decide en funci√≥n del
  <code>DOCTYPE</code>.
</p>
<p>
  La declaraci√≥n en [74] tambi√©n es importante para permitir el uso de letras
  con acentos o e√±ie sin tener que recurrir a cosas como √° o √±, lo que hace que
  la parte est√°tica del texto sea m√°s f√°cil de leer y, por ende, menos pasible
  de contener errores.
</p>
<p>
  Si bien en las l√≠neas [77-95] he inclu√≠do la declaraci√≥n de estilos que uso en
  la p√°gina, lo recomendable es guardar estos estilos en una p√°gina de estilos y
  referenciarla con un
  <em>link</em> como el que se muestra (&lt;!‚Äìcomentado‚Äì>) en [76]. De entre
  todos los estilos, el que quiero resaltar es el uso del atributo
  <code>float:left</code> para la etiqueta <code>label</code>. Esto permite
  armar el formulario con los r√≥tulos junto a los campos, sin necesidad de usar
  tablas, que era la t√©cnica habitual para alinear los campos con sus leyendas.
</p>
<p>
  En [101-108] controlo el argumento <code>confirma</code> y si est√° presente,
  muestro el mensaje de confirmaci√≥n correspondiente. En este caso, la √∫nica
  acci√≥n es mostrar uno u otro mensaje pero en un caso real podr√≠a, por ejemplo,
  volver a cargar las variables con sus valores predeterminados pues, en este
  caso, cuando se da de alta un registro, se vuelve a mostrar el registro con
  los valores reci√©n ingresados cuando que lo m√°s pr√°ctico podr√≠a ser volver a
  ofrecer el formulario en blanco para ingresar nuevos datos.
</p>
<p>
  En [110-115] controlo si hay errores globales, o sea, si hay mensajes cargados
  bajo la clave <code>null</code> en <code>$errores</code>. Si los hay, los
  muestro individualmente. Una vez terminado, los borro del <em>array</em>. Esto
  es para el beneficio de la instrucci√≥n siguiente en [116] pues si luego de
  borrados los errores generales a√∫n quedaran errores, es que son errores de los
  campos. En ese caso, muestro una ayuda indicando c√≥mo reconocer los errores.
  De hecho, esta parte s√≠ funciona en el
  <a
    title="ejemplo"
    href="/int/modelo.php"
    target="_blank"
    rel="noopener noreferrer"
    >ejemplo</a
  >
  sin base de datos, pues como si hay errores no intenta grabar nada, la
  ausencia de la base de datos no molesta. Con s√≥lo hacer clic sobre
  <code>Aceptar</code> se ver√° c√≥mo muestra los errores indicando que los campos
  son obligatorios.
</p>
<p>
  En [124-134] en el caso de que el registro existiera (<code>$id_datos</code>
  distinto de cero) y que no hubiera errores, leo el registro de la base de
  datos y cargo las variables con sus valores. En el caso de la fecha, uso la
  funci√≥n
  <a title="BuildSql.php" href="2007/01/21/arma-sql.html"
    ><code>ReadSqlDate()</code></a
  >
  que se encuentra en
  <a title="BuildSql.php" href="2007/01/21/arma-sql.html"
    ><code>BuildSql.php</code></a
  >.
</p>
<p>
  En [132] muestro un mensaje de error indicando que el registro pedido no
  existe. Este caso es distinto del caso en [11] pues este s√≠ es un error en que
  el usuario puede hacer algo al respecto. El primero lo m√°s probable es que
  fuera un intento de intrusi√≥n, este, en cambio, es posible que sea a
  consecuencia de pedir un registro que fue borrado. Quiz√°s el usuario lo ten√≠a
  guardado en su lista de favoritos, quiz√°s hab√≠a pedido un listado y lo tuvo en
  su pantalla un tiempo hasta que se decidi√≥ a hacer clic en alguno de sus
  enlaces y mientras tanto otro usuario le borr√≥ el registro. En cualquier caso
  el usuario puede hacer algo con la informaci√≥n.
</p>
<p>
  En [136-159] muestro el formulario de ingreso de datos. Noten el uso de las
  etiquetas
  <code>&lt;fieldset>, &lt;legend></code> y <code>&lt;label></code> que son
  relativamente nuevas, aunque hace ya un tiempo que son soportadas por los
  navegadores. Si se es conservador, se puede preferir usar la t√©cnica de usar
  una tabla para alinear los campos con sus leyendas.
</p>
<p>
  Para el formulario en [138] uso el m√©todo <code>get</code>. En la pr√°ctica lo
  m√°s conveniente y seguro es usar <code>post</code>. El <code>get</code> es
  bueno en desarrollo pues me permite ver en la barra de direcciones del
  navegador qu√© datos se han transmitido y hasta me permite jugar con ellos
  directamente en la barra de direcciones para ver c√≥mo responde la aplicaci√≥n.
  Sin embargo, el <code>get</code> expone informaci√≥n innecesariamente, lo cual
  puede hacer que un usuario p√≠caro pueda querer jugar con esos datos. Al decir
  un usuario p√≠caro tampoco me refiero a un hacker, pues este, con ver el fuente
  tambi√©n podr√≠a intentar algo, simplemente me refiero a un usuario que quiera
  ver qu√© pasa si hace esto o aquello sin realmente saber. El
  <code>get</code> tambi√©n tiene limitaci√≥n en el largo de los datos a
  transmitir, largo que es desconocido, pues cada navegador se comporta
  distinto, incluso entre versiones de la misma marca, y si se excede este largo
  no da error, simplemente se trunca la informaci√≥n. El <code>post</code>, por
  el contrario, no tiene l√≠mite de longitud.
</p>
<p>
  Por esta misma raz√≥n he usado
  <code
    ><a
      title="Manual de PHP: variable $_REQUEST"
      href="http://www.php.net/manual/es/reserved.variables.php#reserved.variables.request"
      target="phpmanual"
      rel="noopener noreferrer"
      >$_REQUEST</a
    ></code
  >
  en lugar de
  <code
    ><a
      title="Manual de PHP: variable $_GET "
      href="http://www.php.net/manual/es/reserved.variables.php#reserved.variables.get"
      target="phpmanual"
      rel="noopener noreferrer"
      >$_GET</a
    ></code
  >
  o
  <code
    ><a
      title="Manual de PHP: variable $_POST"
      href="http://www.php.net/manual/es/reserved.variables.php#reserved.variables.post"
      target="phpmanual"
      rel="noopener noreferrer"
      >$_POST</a
    ></code
  >. Al usar
  <code
    ><a
      title="Manual de PHP: variable $_REQUEST"
      href="http://www.php.net/manual/es/reserved.variables.php#reserved.variables.request"
      target="phpmanual"
      rel="noopener noreferrer"
      >$_REQUEST</a
    ></code
  >, si cambio el m√©todo de <code>get</code> a <code>post</code>, la aplicaci√≥n
  sigue funcionando. Una vez hecha la transici√≥n de <code>get</code> a
  <code>post</code> cuando la aplicaci√≥n pase de desarrollo a producci√≥n,
  convendr√° cambiar los
  <code
    ><a
      title="Manual de PHP: variable $_REQUEST"
      href="http://www.php.net/manual/es/reserved.variables.php#reserved.variables.request"
      target="phpmanual"
      rel="noopener noreferrer"
      >$_REQUEST</a
    ></code
  >
  por
  <code
    ><a
      title="Manual de PHP: variable $_POST"
      href="http://www.php.net/manual/es/reserved.variables.php#reserved.variables.post"
      target="phpmanual"
      rel="noopener noreferrer"
      >$_POST</a
    ></code
  >. N√≥tese, sin embargo, que en el caso de <code>$id_datos</code>, es necesario
  usar
  <code
    ><a
      title="Manual de PHP: variable $_REQUEST"
      href="http://www.php.net/manual/es/reserved.variables.php#reserved.variables.request"
      target="phpmanual"
      rel="noopener noreferrer"
      >$_REQUEST</a
    ></code
  >
  dado que el argumento puede ser parte de un <code>URL</code> en un enlace que
  viene de una p√°gina de listado o puede venir del <em>submit</em> del
  formulario, as√≠ que debe ser posible leerlo en ambos casos.
</p>
<p>
  En [139] incluyo un campo de tipo <em>hidden</em> para guardar el valor de la
  clave del registro, ya fuera cero, para indicar que se va a hacer un alta o el
  valor concreto de la clave primaria del registro que se va a modificar.
</p>
<p>
  En todos los campos, cargo el atributo <code>value</code> con el valor de la
  variable que corresponde. En [142] al valor de <code>$nombre</code> le aplico
  la funci√≥n
  <a
    title="Manual de PHP: funci√≥n htmlentities()"
    href="http://www.php.net/manual/es/function.htmlentities.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>htmlentities()</code></a
  >
  para asegurarme que cualquier caracter especial que pudiera contener este
  campo no generar√° HTML inv√°lido. En este caso no ser√≠a necesario pues por la
  validaci√≥n que hiciera en [22] y la declaraci√≥n del <em>charset</em> a usar en
  [74], no deber√≠an presentarse caracteres especiales.
</p>
<p>
  Tras cada campo <code>&lt;input></code> llamo a la funci√≥n
  <code>mostrar_error()</code>, que se muestra en [164-173]. Lo que hace es
  verificar si el array <code>$errores</code> contiene valores bajo la clave que
  se le indica y que usualmente corresponde al nombre del campo, y si los
  hubiera, muestra un icono de alerta y carga el mensaje como tooltip para que
  el usuario lo pueda ver con s√≥lo dejar el cursor un momento sobre el s√≠mbolo.
  Esto permite mostrar la ubicaci√≥n de los errores y dar un mensaje de error
  significativo sin estropear el dise√±o de la p√°gina.
</p>
<p>
  Aunque as√≠ como aparece el ejemplo parece muy largo, para una aplicaci√≥n
  simple, hay que notar que buena parte est√° ocupada por la validaci√≥n de datos
  que, en la pr√°ctica, se har√≠a con simples llamadas a funciones en alg√∫n
  archivo
  <a
    title="Manual de PHP: funci√≥n include()"
    href="http://www.php.net/manual/es/function.include.php"
    target="phpmanual"
    rel="noopener noreferrer"
    ><code>include</code></a
  >. El estilo deber√≠a darse en una hoja de estilo, no dentro de la misma
  p√°gina, estilo que ser√≠a compartido por todas las p√°ginas del sitio,
  asegur√°ndose aspecto consistente. La funci√≥n
  <code>mostrar_error()</code> obviamente deber√≠a ser parte de las funciones
  comunes al sitio. N√≥tese tambi√©n la regularidad en el armado de los campos del
  formulario. Todos los campos se podr√≠an generar con una llamada por cada campo
  a una funci√≥n a la que se le indicara el nombre del campo, el valor y el tipo
  de dato.
</p>
<p>
  Toda la validaci√≥n hecha en la primera parte deber√≠a ser, en realidad, la
  segunda validaci√≥n. La primera validaci√≥n deber√≠a hacerse mediante JavaScript
  en el mismo navegador. Ambas son importantes y necesarias. La primera, en
  JavaScript en el cliente, le provee al usuario un <em>feedback</em> inmediato,
  sin tener que esperar la respuesta desde el servidor y sin ocupar recursos de
  este. La segunda, en el servidor, es necesaria pues algunos usuarios
  inhabilitan el JavaScript en sus navegadores por lo que no puede suponerse que
  los datos que llegan est√©n validados. La validaci√≥n en el cliente es por una
  cuesti√≥n de fluidez de la aplicaci√≥n, la segunda es imprescindible por
  seguridad.
</p>

          </div>
          <footer class="post-footer"><div class="next-prev-links">
  <a  class="prev-link" title="Anterior"
href="2007/03/24/sudoku-tetradimensional.html"
>
<div class="triangle-left"></div>
Sudoku tetradimensional
</a>

  <a class="next-link" title="Siguiente"
href="2007/02/26/tomografia-dental.html"
>Tomograf√≠a dental 
<div class="triangle-right"></div>
</a>

</div> </footer>
          <a class="u-url" href="/blog/2007/03/08/modelo-de-pagina-activa-de-ingreso-de-datos.html" hidden></a>
        </article>
      </div>
    </main>
    <footer class="site-footer h-card">
      <data class="u-url" href="/blog"></data>

      <div class="wrapper">
        <h2 class="footer-heading">Comentarios</h2>

        <div class="footer-col-wrapper">
          <div class="footer-col footer-col-1">
            <ul class="contact-list">
              <li class="p-name">Comentarios</li>
              <li>
                <a class="u-email" href="mailto:satyam@satyam.com.ar"
                  >satyam@satyam.com.ar</a
                >
              </li>
            </ul>
          </div>

          <div class="footer-col footer-col-2">
            <ul class="social-media-list"></ul>
          </div>

          <div class="footer-col footer-col-3">
            <p>Comentarios, viajes, ideas e historias</p>
          </div>
        </div>
      </div>
    </footer>
    
  </body>
</html>
