<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>yui3-gallery&#x2F;src&#x2F;gallery-md-timespinner&#x2F;js&#x2F;gallery-md-timespinner.js - Satyam&#x27;s Gallery Modules</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="Satyam&#x27;s Gallery Modules"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Accordion.html">Accordion</a></li>
            
                <li><a href="..&#x2F;classes/AccordionPanel.html">AccordionPanel</a></li>
            
                <li><a href="..&#x2F;classes/Button.html">Button</a></li>
            
                <li><a href="..&#x2F;classes/ButtonGroup.html">ButtonGroup</a></li>
            
                <li><a href="..&#x2F;classes/ButtonPlugin.html">ButtonPlugin</a></li>
            
                <li><a href="..&#x2F;classes/ButtonSeparator.html">ButtonSeparator</a></li>
            
                <li><a href="..&#x2F;classes/ButtonToggle.html">ButtonToggle</a></li>
            
                <li><a href="..&#x2F;classes/IButton.html">IButton</a></li>
            
                <li><a href="..&#x2F;classes/MakeNode.html">MakeNode</a></li>
            
                <li><a href="..&#x2F;classes/Node.html">Node</a></li>
            
                <li><a href="..&#x2F;classes/Spinner.html">Spinner</a></li>
            
                <li><a href="..&#x2F;classes/StdMod.html">StdMod</a></li>
            
                <li><a href="..&#x2F;classes/TimeSpinner.html">TimeSpinner</a></li>
            
                <li><a href="..&#x2F;classes/Y.FlyweightTreeManager.html">Y.FlyweightTreeManager</a></li>
            
                <li><a href="..&#x2F;classes/Y.FlyweightTreeNode.html">Y.FlyweightTreeNode</a></li>
            
                <li><a href="..&#x2F;classes/Y.FWTreeNode.html">Y.FWTreeNode</a></li>
            
                <li><a href="..&#x2F;classes/Y.FWTreeView.html">Y.FWTreeView</a></li>
            
                <li><a href="..&#x2F;classes/Y.GalleryModel.html">Y.GalleryModel</a></li>
            
                <li><a href="..&#x2F;classes/Y.GalleryModelChronologicalUndo.html">Y.GalleryModelChronologicalUndo</a></li>
            
                <li><a href="..&#x2F;classes/Y.GalleryModelMultiRecord.html">Y.GalleryModelMultiRecord</a></li>
            
                <li><a href="..&#x2F;classes/Y.GalleryModelPrimaryKeyIndex.html">Y.GalleryModelPrimaryKeyIndex</a></li>
            
                <li><a href="..&#x2F;classes/Y.GalleryModelSimpleUndo.html">Y.GalleryModelSimpleUndo</a></li>
            
                <li><a href="..&#x2F;classes/Y.GalleryModelSortedMultiRecord.html">Y.GalleryModelSortedMultiRecord</a></li>
            
                <li><a href="..&#x2F;classes/Y.Timeline.html">Y.Timeline</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/gallery-button-plugin.html">gallery-button-plugin</a></li>
            
                <li><a href="..&#x2F;modules/gallery-flyweight-tree.html">gallery-flyweight-tree</a></li>
            
                <li><a href="..&#x2F;modules/gallery-fwt-treeview.html">gallery-fwt-treeview</a></li>
            
                <li><a href="..&#x2F;modules/gallery-makenode.html">gallery-makenode</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-accordion.html">gallery-md-accordion</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-button.html">gallery-md-button</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-button-group.html">gallery-md-button-group</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-ibutton.html">gallery-md-ibutton</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-model.html">gallery-md-model</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-spinner.html">gallery-md-spinner</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-timespinner.html">gallery-md-timespinner</a></li>
            
                <li><a href="..&#x2F;modules/gallery-stdmod.html">gallery-stdmod</a></li>
            
                <li><a href="..&#x2F;modules/timeline.html">timeline</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: yui3-gallery&#x2F;src&#x2F;gallery-md-timespinner&#x2F;js&#x2F;gallery-md-timespinner.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;*js lint white: true, nomen: true, maxerr: 50, indent: 4 *&#x2F;
&#x2F;*gl obal Y*&#x2F;
&#x2F;**
* Shows and accepts a time via a set of spinners.  
* It can run showing the current time.
* @module gallery-md-timespinner
*&#x2F;
&quot;use strict&quot;;

var Spinner = Y.Spinner,
	Lang = Y.Lang,
	CBX = &#x27;contentBox&#x27;,
	BBX = &#x27;boundingBox&#x27;,
	CHANGE = &#x27;Change&#x27;,
	VALUE = &#x27;value&#x27;,
	UI = &#x27;ui&#x27;,
	SHOW_AMPM = &#x27;showAmPm&#x27;,
	MIN = &#x27;min&#x27;,
	MAX = &#x27;max&#x27;,
	INTERVAL = &#x27;interval&#x27;,
	SHOW_SECONDS = &#x27;showSeconds&#x27;,
	RUNNING = &#x27;running&#x27;,
	AFTER = &#x27;after&#x27;,
	WRAPPED = &#x27;wrapped&#x27;,
	HOURS = &#x27;hours&#x27;,
	MINUTES = &#x27;minutes&#x27;,
	SECONDS = &#x27;seconds&#x27;,
	AMPM = &#x27;ampm&#x27;;
&#x2F;**
 * The TimeSpinner shows a set of spinners for hour, minute and optionally seconds and AM&#x2F;PM.
 * @class TimeSpinner
 * @extends Widget
 * @uses Y.Spinner, Y.MakeNode
 * @constructor 
 * @param cfg {object} (optional) configuration attributes
 *&#x2F;	
Y.TimeSpinner = Y.Base.create(
	&#x27;timeSpinner&#x27;,
	Y.Widget,
	[Y.MakeNode],
	{
		&#x2F;**
		 * Reference to the Spinner showing the hours.
		 * @property _hourSp
		 * @type Y.Spinner
		 * @default null
		 * @private
		 *&#x2F;
		_hourSp: null,
		&#x2F;**
		 * Reference to the Spinner showing the minutes.
		 * @property _minSp
		 * @type Y.Spinner
		 * @default null
		 * @private
		 *&#x2F;
		_minSp: null,
		&#x2F;**
		 * Reference to the Spinner showing the seconds.
		 * @property _secSp
		 * @type Y.Spinner
		 * @default null
		 * @private
		 *&#x2F;
		_secSp: null,
		&#x2F;**
		 * Reference to the Spinner showingam&#x2F;pm.
		 * @property _ampmSp
		 * @type Y.Spinner
		 * @default null
		 * @private
		 *&#x2F;
		_ampmSp: null,
		&#x2F;**
		 * Reference to the timer created by Y.later that updates the time.
		 * @property _timer
		 * @type timer object
		 * @default null
		 * @private
		 *&#x2F;
		_timer: null,
		&#x2F;**
		 * Difference in milliseconds in between the current time and that displayed.  
		 * Used when the timer is running to display times other than the current time.
		 * @property _offset
		 * @type Number
		 * @default 0
		 * @private
		 *&#x2F;
		_offset: 0,
		
		&#x2F;** Used to store the moment when the timer was stopped
		 * @property _frozenTime
		 * @type Number (milliseconds)
		 * @default 0
		 * @private
		 *&#x2F;
		_frozenTime: 0,
		
		&#x2F;**
		 * Helper factory to make a single Spinner
		 * @method _spFact
		 * @param which {String} ClassName key for the spinner and strings subkey for its title
		 * @param cfg {object} (optional) configuration attribute overrides
		 * @param where {Node} (optional) where to render it
		 * @return {Spinner} Spinner instance
		 * @private
		 *&#x2F;
		_spFact: function (which, cfg, where) {
			var sp = new Spinner(Y.merge({
				min: 0,
				max: 59,
				wraparound: true,
				&#x27;strings.input&#x27;: this.get(&#x27;strings.&#x27; + which)
			},cfg)).render(where);
			sp.get(BBX).addClass(this._classNames[which]);
			return sp;
		},
		&#x2F;**
		 * Renders the hours and minutes spinners. 
		 * The other two, being optional, are rendered when set.
		 * @method renderUI
		 * @protected
		 *&#x2F;
		renderUI: function() {
			Y.log(&#x27;renderUI&#x27;, &#x27;info&#x27;, &#x27;TimeSpinner&#x27;);
			var cbx = this.get(CBX);
				
			this._hourSp = this._spFact(HOURS, this.get(SHOW_AMPM)?{min:1,max:12}:{max:23}, cbx);
			this._minSp = this._spFact(MINUTES, null, cbx);
		},
		&#x2F;**
		 * Sets the listeners for events from the hours and minutes spinners.
		 * @method bindUI
		 * @protected
		 *&#x2F;
		bindUI: function () {
			Y.log(&#x27;bindUI&#x27;, &#x27;info&#x27;, &#x27;TimeSpinner&#x27;);
			this._eventHandles = [
				this._hourSp.after(VALUE + CHANGE, this._afterValueChange, this),
				this._minSp.after(VALUE + CHANGE, this._afterValueChange, this),
				this._minSp.after(WRAPPED, this._afterWrapped, this)
			];
		},
		
		destroy: function () {
			Y.log(&#x27;destroy&#x27;, &#x27;info&#x27;, &#x27;TimeSpinner&#x27;);
			if (this._timer) {
				this._timer.cancel();
			}
			Y.each([].concat(this._eventHandles,this._secondsEventHandles,this._ampmEventHandle), function (eh) {
				if (eh) {
					eh.detach();
				}
			});
			Y.TimeSpinner.superclass.destroy.call(this);
		},
		
		&#x2F;**
		 * Creates or destroys the seconds spinner and attaches&#x2F;detaches the event listeners.
		 * @method _uiSetSeconds
		 * @param value {Boolean} whether to show the seconds spinner or not
		 * @private
		 *&#x2F;
		_uiSetShowSeconds: function(value) {
			Y.log(&#x27;_uiSetShowSeconds, value: &#x27; + value, &#x27;info&#x27;, &#x27;TimeSpinner&#x27;);
			if (value) {
				this._secSp = this._spFact(SECONDS,{
					value: this.get(VALUE).getSeconds()
				});
				this._minSp.get(BBX).insert(this._secSp.get(BBX), AFTER);
				this._secondsEventHandles = [
					this._secSp.after(VALUE + CHANGE, this._afterValueChange, this),
					this._secSp.after(WRAPPED, this._afterWrapped, this)
				];
			} else if (this._secSp) {
				if (this._secSp) {
					Y.each(this._secondsEventHandles, function (eh) {
						eh.detach();
					});
					this._secSp.destroy();
					this._secSp = null;
				}
			}
		},
		&#x2F;**
		 * Creates or destroys the am&#x2F;pm spinner and attaches&#x2F;detaches the event listeners.
		 * @method _uiSetAmpm
		 * @param value {Boolean} whether to show the am&#x2F;pm spinner or not
		 * @private
		 *&#x2F;
		_uiSetShowAmPm: function (value) {
			Y.log(&#x27;_uiSetShowAmPm, value: &#x27; + value, &#x27;info&#x27;, &#x27;TimeSpinner&#x27;);
			if (value) {
				this._ampmSp = this._spFact(AMPM, {
					max:1,
					formatter: function(value) {
						return value?&#x27;PM&#x27;:&#x27;AM&#x27;;
					},
					parser: function (value) {
						switch (value.toUpperCase()) {
							case &#x27;AM&#x27;:
								return 0;
							case &#x27;PM&#x27;:
								return 1;
							default:
								return false;
						}
					}
				});
				(this._secSp?this._secSp.get(BBX):this._minSp.get(BBX)).insert(this._ampmSp.get(BBX), AFTER);
				this._ampmEventHandle = this._ampmSp.after(VALUE + CHANGE, this._afterValueChange, this);
				this._hourSp.setAttrs({
					max: 12,
					min: 1
				});
				this._uiSetValue(this.get(VALUE));
			} else {
				this._hourSp.setAttrs({
					max: 23,
					min: 0
				});
				if (this._ampmSp) {
					this._ampmEventHandle.detach();
					this._ampmSp.destroy();
					this._ampmSp = null;
				}
			}
		},
		&#x2F;**
		 * Shows the current value in the set of spinners
		 * @method _uiSetValue
		 * @param value {Date} value to be shown
		 * @param src {String} source of the change in value.  
		 *        If src===UI, the value comes from the spinners, it needs not be refreshed
		 * @private
		 *&#x2F;
		_uiSetValue: function (value, src) {
			Y.log(&#x27;_uiSetValue, value: &#x27; + value + &#x27; src &#x27; + src, &#x27;info&#x27;, &#x27;TimeSpinner&#x27;);
			if (src === UI) {
				return;
			}
			this._setting = true;
			var hours = value.getHours();
			if (this._ampmSp) {
				this._hourSp.set(VALUE, (hours % 12) || 12);
				this._ampmSp.set(VALUE, hours &gt;= 12?1:0);
			} else {
				this._hourSp.set(VALUE, hours);
			}
			this._minSp.set(VALUE, value.getMinutes());
			if (this._secSp) {
				this._secSp.set(VALUE, value.getSeconds());
			}
			this._setting = false;
		},
		
		&#x2F;**
		 * Sets the interval for refreshing the display
		 * @method _uiSetInterval
		 * @param value {number} milliseconds in between refreshes
		 * @private
		 *&#x2F;
		_uiSetInterval: function (value) {
			Y.log(&#x27;_uiSetInterval, value: &#x27; + value, &#x27;info&#x27;, &#x27;TimeSpinner&#x27;);
			if (this._timer) {
				this._timer.cancel();
			}
			if (value) {
				this._timer = Y.later(value, this, this._updateTime, [], true);
			}
		},
		&#x2F;**
		 * Sets the timer running.
		 * @method _uiSetRunning
		 * @param value {Boolean} run or not
		 * @private
		 *&#x2F;
		_uiSetRunning: function (value) {
			Y.log(&#x27;_uiSetRunning, value: &#x27; + value, &#x27;info&#x27;, &#x27;TimeSpinner&#x27;);
			this._uiSetInterval(value &amp;&amp; this.get(INTERVAL));
			this._frozenTime = Date.now();
		},
		
		&#x2F;**
		 * Listener for a change in any of the spinners, sets the value.
		 * @method _afterValueChange
		 * @private
		 *&#x2F;
		_afterValueChange: function () {
			if (this._setting) {
				return;
			}
			Y.log(&#x27;_afterValueChange&#x27;, &#x27;info&#x27;, &#x27;TimeSpinner&#x27;);
			var d = new Date();
			d.setHours((this._hourSp.get(VALUE) + (this._ampmSp? 12 * this._ampmSp.get(VALUE):0)) % 24);
			d.setMinutes(this._minSp.get(VALUE));
			d.setSeconds(this._secSp?this._secSp.get(VALUE):0);
			this.set(VALUE, d, {src: UI}); 
		},
		
		&#x2F;**
		 * Listener for the wrapped event of the spinners to propagate 
		 * the changes from seconds to minutes and minutes to hours.
		 * @method
		 * @param ev {EventFacade} to find out which one wrapped and which way
		 * @private
		 *&#x2F;
		_afterWrapped: function (ev) {
			Y.log(&#x27;_afterWrapped&#x27;, &#x27;info&#x27;, &#x27;TimeSpinner&#x27;);
			var dir = ev.newVal &gt; ev.prevVal?-1:1;
			if (ev.target === this._secSp) {
				this._minSp.set(VALUE, this._minSp.get(VALUE) + dir);
			}
			if (ev.target === this._minSp) {
				this._hourSp.set(VALUE, this._hourSp.get(VALUE) + dir);
			}
		},
		
		&#x2F;**
		 * Callback for the interval timer to update the time shown
		 * @method _updateTime
		 * @private
		 *&#x2F;
		_updateTime: function() {
			Y.log(&#x27;_updateTime&#x27;, &#x27;info&#x27;, &#x27;TimeSpinner&#x27;);
			this._uiSetValue(this._getTime());
		},
		&#x2F;**
		 * Getter for the time value.  It returns the current time minus the offset 
		 * or the time when it was stopped.
		 * @method _getTime
		 * @return {Date} Time shown
		 * @private
		 *&#x2F;
		_getTime: function() {
			Y.log(&#x27;_getTime&#x27;, &#x27;info&#x27;, &#x27;TimeSpinner&#x27;);
			if (this.get(RUNNING)) {
				return new Date(Date.now() - this._offset);
			} else {
				return new Date(this._frozenTime - this._offset);
			}
		},
		&#x2F;**
		 * Setter for the time value.  
		 * It calculates and saves the offset in between the current time and that set.
		 * @method _setTime
		 * @param value {Date} time to be shown
		 * @private
		 *&#x2F;
		_setTime: function (value) {
			Y.log(&#x27;_setTime, value &#x27; + value, &#x27;info&#x27;, &#x27;TimeSpinner&#x27;);
			this._offset = Date.now() - value.getTime();
			return value;
		},
		
		&#x2F;**
		 * Helper method to set the timer running.
		 * Same as &lt;code&gt;this.set(&#x27;running&#x27;, true);&lt;&#x2F;code&gt;
		 * @method start
		 *&#x2F;
		start: function () {
			Y.log(&#x27;start&#x27;, &#x27;info&#x27;, &#x27;TimeSpinner&#x27;);
			this.set(RUNNING, true);
		},
		&#x2F;**
		 * Helper method to stop the timer.
		 * Same as &lt;code&gt;this.set(&#x27;running&#x27;, false);&lt;&#x2F;code&gt;
		 * @method stop
		 *&#x2F;
		stop: function () {
			Y.log(&#x27;stop&#x27;, &#x27;info&#x27;, &#x27;TimeSpinner&#x27;);
			this.set(RUNNING, false);
		}
	},
	{
		_CLASS_NAMES: [HOURS, MINUTES, SECONDS, AMPM],
		ATTRS: {
			&#x2F;**
			 * Whether to show the am&#x2F;pm indicator or show a 24 hours timer.
			 * @attribute showAmPm
			 * @type Boolean
			 * @default false
			 *&#x2F;
			showAmPm : {
				value:false,
				validator: Lang.isBoolean
			},
			&#x2F;**
			 * Whether to show the seconds indicator
			 * @attribute showSeconds
			 * @type Boolean
			 * @default true
			 *&#x2F;
			showSeconds:{
				value:true,
				validator: Lang.isBoolean
			},
			&#x2F;**
			 * Value of the timer
			 * @attribute value
			 * @type Date
			 * @default time at initialization or current time if running
			 *&#x2F;
			value: {
				valueFn: function() {
					return new Date();
				},
				validator: function (value) {
					return value instanceof Date;
				},
				getter:&#x27;_getTime&#x27;,
				setter:&#x27;_setTime&#x27;
			},
			
			&#x2F;**
			 * How often to refresh the time displayed
			 * @attribute interval
			 * @type Number (milliseconds)
			 * @default 500
			 *&#x2F;
			interval: {
				value: 500,
				validator: Lang.isNumber
			},
			
			&#x2F;**
			 * Whether the timer is running.
			 * @attribute running
			 * @type Boolean
			 * @default true
			 *&#x2F;
			running: {
				value: true,
				validator: Lang.isBoolean
			},
			
			&#x2F;**
			 * Set of localizable strings to be used as tooltips on the spinners.
			 * @attribute strings
			 *&#x2F;
			strings: {
				value: {
					hours:HOURS,
					minutes:MINUTES,
					seconds: SECONDS,
					ampm: &#x27;am&#x2F;pm&#x27;
				}
			}
		},
		_ATTRS_2_UI: {
			BIND: [INTERVAL, RUNNING, SHOW_AMPM, SHOW_SECONDS, VALUE],
			SYNC: [INTERVAL, RUNNING, SHOW_AMPM, SHOW_SECONDS, VALUE]
		}
	}
);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
