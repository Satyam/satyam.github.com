<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src&#x2F;gallery-md-model&#x2F;js&#x2F;multi-record-sorted.js - Satyam&#x27;s Gallery Modules</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="Satyam&#x27;s Gallery Modules"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Accordion.html">Accordion</a></li>
            
                <li><a href="..&#x2F;classes/AccordionPanel.html">AccordionPanel</a></li>
            
                <li><a href="..&#x2F;classes/Button.html">Button</a></li>
            
                <li><a href="..&#x2F;classes/ButtonGroup.html">ButtonGroup</a></li>
            
                <li><a href="..&#x2F;classes/ButtonPlugin.html">ButtonPlugin</a></li>
            
                <li><a href="..&#x2F;classes/ButtonSeparator.html">ButtonSeparator</a></li>
            
                <li><a href="..&#x2F;classes/ButtonToggle.html">ButtonToggle</a></li>
            
                <li><a href="..&#x2F;classes/FlyweightTreeManager.html">FlyweightTreeManager</a></li>
            
                <li><a href="..&#x2F;classes/FlyweightTreeNode.html">FlyweightTreeNode</a></li>
            
                <li><a href="..&#x2F;classes/FWTreeNode.html">FWTreeNode</a></li>
            
                <li><a href="..&#x2F;classes/FWTreeView.html">FWTreeView</a></li>
            
                <li><a href="..&#x2F;classes/GalleryModel.html">GalleryModel</a></li>
            
                <li><a href="..&#x2F;classes/GalleryModelChronologicalUndo.html">GalleryModelChronologicalUndo</a></li>
            
                <li><a href="..&#x2F;classes/GalleryModelMultiRecord.html">GalleryModelMultiRecord</a></li>
            
                <li><a href="..&#x2F;classes/GalleryModelPrimaryKeyIndex.html">GalleryModelPrimaryKeyIndex</a></li>
            
                <li><a href="..&#x2F;classes/GalleryModelSimpleUndo.html">GalleryModelSimpleUndo</a></li>
            
                <li><a href="..&#x2F;classes/GalleryModelSortedMultiRecord.html">GalleryModelSortedMultiRecord</a></li>
            
                <li><a href="..&#x2F;classes/IButton.html">IButton</a></li>
            
                <li><a href="..&#x2F;classes/MakeNode.html">MakeNode</a></li>
            
                <li><a href="..&#x2F;classes/Node.html">Node</a></li>
            
                <li><a href="..&#x2F;classes/Spinner.html">Spinner</a></li>
            
                <li><a href="..&#x2F;classes/StdMod.html">StdMod</a></li>
            
                <li><a href="..&#x2F;classes/TimeSpinner.html">TimeSpinner</a></li>
            
                <li><a href="..&#x2F;classes/Y.Timeline.html">Y.Timeline</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/gallery-button-plugin.html">gallery-button-plugin</a></li>
            
                <li><a href="..&#x2F;modules/gallery-flyweight-tree.html">gallery-flyweight-tree</a></li>
            
                <li><a href="..&#x2F;modules/gallery-fwt-treeview.html">gallery-fwt-treeview</a></li>
            
                <li><a href="..&#x2F;modules/gallery-makenode.html">gallery-makenode</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-accordion.html">gallery-md-accordion</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-button.html">gallery-md-button</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-button-group.html">gallery-md-button-group</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-ibutton.html">gallery-md-ibutton</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-model.html">gallery-md-model</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-spinner.html">gallery-md-spinner</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-timespinner.html">gallery-md-timespinner</a></li>
            
                <li><a href="..&#x2F;modules/gallery-stdmod.html">gallery-stdmod</a></li>
            
                <li><a href="..&#x2F;modules/timeline.html">timeline</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src&#x2F;gallery-md-model&#x2F;js&#x2F;multi-record-sorted.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">

&#x2F;**
 * Extension to sort records stored in {{#crossLink &quot;GalleryModel&quot;}}{{&#x2F;crossLink}},
 * extended with {{#crossLink &quot;GalleryModelMultiRecord&quot;}}{{&#x2F;crossLink}}
 * It is incompatible with {{#crossLink &quot;GalleryModelPrimaryKeyIndex&quot;}}{{&#x2F;crossLink}}
 * @class GalleryModelSortedMultiRecord
 *&#x2F;
SMR = function () {};

SMR.prototype = {
    &#x2F;**
     * Compare function used in sorting.
     * @method _compare
     * @param a {object} shelf to compare
     * @param b {object} shelf to compare
     * @return {integer} -1, 0 or 1 as required by Array.sort
     * @private
     *&#x2F;
    _compare: null,
    &#x2F;**
     * Initializer lifecycle method.
     * Ensures proper defaults, sets the compare method and
     * sets listeners for relevant events
     * @method initializer
     * @protected
     *&#x2F;
    initializer: function () {
        if (this.get(SFIELD) === undefined) {
            this._set(SFIELD, this.get(&#x27;primaryKeys&#x27;)[0]);
        }
        this._setCompare();
        this.after([SFIELD + CHANGE, SDIR + CHANGE], this._sort);
        this.after(EVT_CHANGE, this._afterChange);
    },
    &#x2F;**
     * Sets the compare function to be used in sorting the records
     * based on the {{#crossLink &quot;GalleryModelSortedMultiRecord&#x2F;sortField:attribute&quot;}}{{&#x2F;crossLink}}
     * and {{#crossLink &quot;GalleryModelSortedMultiRecord&#x2F;sortDir:attribute&quot;}}{{&#x2F;crossLink}}
     * attributes and stores it into this._compare
     * @method _setCompare
     * @private
     *&#x2F;
    _setCompare: function () {
        var sortField = this.get(SFIELD),
            sortAsc = this.get(SDIR) === ASC?1:-1,
            compareValue = (Lang.isFunction(sortField)?
                sortField:
                function(values) {
                    return values[sortField];
                }
            );
        this._compare = function(a, b) {
            var aValue = compareValue(a._values),
                bValue = compareValue(b._values);

            return (aValue &lt; bValue ? -1 : (aValue &gt; bValue ? 1 : 0)) * sortAsc;
        };
    },
    &#x2F;**
     * Sorts the shelves whenever the
     * {{#crossLink &quot;GalleryModelSortedMultiRecord&#x2F;sortField:attribute&quot;}}{{&#x2F;crossLink}}
     * or {{#crossLink &quot;GalleryModelSortedMultiRecord&#x2F;sortDir:attribute&quot;}}{{&#x2F;crossLink}}
     * attributes change.
     * @method _sort
     * @private
     *&#x2F;
    _sort: function() {
        this._setCompare();
        this._shelve();
        this._shelves.sort(this._compare);
        this._shelves.splice(this.size());
        this._fetch(0);
    },
    &#x2F;**
     * Listens to value changes and if the name of the field is that of the
     * {{#crossLink &quot;GalleryModelSortedMultiRecord&#x2F;sortField:attribute&quot;}}{{&#x2F;crossLink}} attribute
     * or if {{#crossLink &quot;GalleryModelSortedMultiRecord&#x2F;sortField:attribute&quot;}}{{&#x2F;crossLink}}
     * is a function, it will relocate the record to its proper sort order
     * @method _afterChange
     * @param ev {EventFacade} Event fa√ßade as produced by the {{#crossLink &quot;GalleryModel&#x2F;change:event&quot;}}{{&#x2F;crossLink}}  event
     * @private
     *&#x2F;
    _afterChange: function (ev) {
        var fieldName = ev.name,
            sField = this.get(SFIELD),
            index,
            currentIndex = this._currentIndex,
            shelves = this._shelves,
            currentShelf;

        if (fieldName &amp;&amp; ev.src !== ADD &amp;&amp; (Lang.isFunction(sField) || fieldName === sField)) {
            &#x2F;&#x2F; The shelf has to be emptied otherwise _findIndex may match itself.
            currentShelf = shelves.splice(currentIndex,1)[0];
            index = this._findIndex(currentShelf._values);
            shelves.splice(index,0,currentShelf);
            this._currentIndex = index;
        }
    },
    &#x2F;**
     * Finds the correct index position of a record within the shelves
     * according to the current
     * {{#crossLink &quot;GalleryModelSortedMultiRecord&#x2F;sortField:attribute&quot;}}{{&#x2F;crossLink}}
     * or {{#crossLink &quot;GalleryModelSortedMultiRecord&#x2F;sortDir:attribute&quot;}}{{&#x2F;crossLink}}
     * attributes
     * @method _findIndex
     * @param values {Object} values of the record to be located
     * @return {Integer} location for the record
     * @private
     *&#x2F;
    _findIndex: function (values) {
        var shelves = this._shelves,
            low = 0,
            high = shelves.length,
            index = 0,
            cmp = this._compare,
            vals = {_values: values};

        while (low &lt; high) {
            index = Math.floor((high + low) &#x2F; 2);
            switch(cmp(vals, shelves[index])) {
                case 1:
                    low = index + 1;
                    break;
                case -1:
                    high = index;
                    break;
                default:
                    low = high = index;
            }

        }
        return low;

    },
    &#x2F;**
     * Adds a new record at its proper position according to the sort configuration.
     * It overrides
     * {{#crossLink &quot;GalleryModelMultiRecord&quot;}}{{&#x2F;crossLink}}&#x27;s own
     * {{#crossLink &quot;GalleryModelMultiRecord&#x2F;add&quot;}}{{&#x2F;crossLink}}
     * method, ignoring the index position requested, if any.
     * The new record becomes the current.
     * @method add
     * @param values {Object|Array} set of values to set.
     * If it is an array, it will call itself for each of the items in it.
     * @chainable
     *&#x2F;
    add: function(values) {
        if (Lang.isArray(values)) {
            YArray.each(values, this.add, this);
            return this;
        }
        var shelves = this._shelves,
            index = 0;

        index = this._findIndex(values);
        this._currentIndex = index;
        shelves.splice(index, 0, {});
        this._initNew();
        this.setValues(values, ADD);
        this._shelve(index);
        return this;
    },
    &#x2F;**
     * Locates a record by value.  The record will be located by the field
     * given in the {{#crossLink &quot;GalleryModelSortedMultiRecord&#x2F;sortField:attribute&quot;}}{{&#x2F;crossLink}}
     *  attribute.   It will return the index of the
     * record in the shelves or &#x60;null&#x60; if not found.
     * By default it will expose that record.
     * If {{#crossLink &quot;GalleryModelSortedMultiRecord&#x2F;sortField:attribute&quot;}}{{&#x2F;crossLink}}
     * contains a function, it will return &#x60;null&#x60; and do nothing.
     * Since sort fields need not be unique, find may return any of the records
     * with the same value for that field.
     * @method find
     * @param value {Any} value to be found
     * @param [move] {Boolean} exposes the record found, defaults to &#x60;true&#x60;
     * @return {integer | null} index of the record found or &#x60;null&#x60; if not found.
     * Be sure to differentiate a return of &#x60;0&#x60;, a valid index, from &#x60;null&#x60;, a failed search.
     *&#x2F;
    find: function (value, move) {
        var sfield = this.get(SFIELD),
            index,
            values = {};
        if (Lang.isFunction(sfield)) {
            return null;
        }
        values[sfield] = value;
        index = this._findIndex(values);
        if (this._shelves[index]._values[sfield] !== value) {
            return null;
        }
        if (move || arguments.length &lt; 2) {
            this.set(INDEX, index);
        }
        return index;
    }
};
SMR.ATTRS = {
    &#x2F;**
     * Name of the field to sort by or function to build the value used for comparisson.
     * If a function, it will receive a reference to the record to be sorted;
     * it should return the value to be used for comparisson.  Functions are
     * used when sorting on multiple keys, which the function should return
     * concatenated, or when any of the fields needs some pre-processing.
     * @attribute sortField
     * @type String | Function
     * @default first primary key field
     *&#x2F;
    sortField: {
        validator: function (value){
            return Lang.isString(value) || Lang.isFunction(value);
        }
    },
    &#x2F;**
     * Sort direction either &#x60;&quot;asc&quot;&#x60; for ascending or &#x60;&quot;desc&quot;&#x60; for descending
     * @attribute sortDir
     * @type String
     * @default &quot;asc&quot;
     *&#x2F;
    sortDir: {
        validator: function (value) {
            return value === DESC || value === ASC;
        },
        value: ASC
    }
};
Y.GalleryModelSortedMultiRecord = SMR;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
