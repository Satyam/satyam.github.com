<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src&#x2F;gallery-md-model&#x2F;js&#x2F;multi-record.js - Satyam&#x27;s Gallery Modules</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="Satyam&#x27;s Gallery Modules"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Accordion.html">Accordion</a></li>
            
                <li><a href="..&#x2F;classes/AccordionPanel.html">AccordionPanel</a></li>
            
                <li><a href="..&#x2F;classes/Button.html">Button</a></li>
            
                <li><a href="..&#x2F;classes/ButtonGroup.html">ButtonGroup</a></li>
            
                <li><a href="..&#x2F;classes/ButtonPlugin.html">ButtonPlugin</a></li>
            
                <li><a href="..&#x2F;classes/ButtonSeparator.html">ButtonSeparator</a></li>
            
                <li><a href="..&#x2F;classes/ButtonToggle.html">ButtonToggle</a></li>
            
                <li><a href="..&#x2F;classes/FlyweightTreeManager.html">FlyweightTreeManager</a></li>
            
                <li><a href="..&#x2F;classes/FlyweightTreeNode.html">FlyweightTreeNode</a></li>
            
                <li><a href="..&#x2F;classes/FWTreeNode.html">FWTreeNode</a></li>
            
                <li><a href="..&#x2F;classes/FWTreeView.html">FWTreeView</a></li>
            
                <li><a href="..&#x2F;classes/GalleryModel.html">GalleryModel</a></li>
            
                <li><a href="..&#x2F;classes/GalleryModelChronologicalUndo.html">GalleryModelChronologicalUndo</a></li>
            
                <li><a href="..&#x2F;classes/GalleryModelMultiRecord.html">GalleryModelMultiRecord</a></li>
            
                <li><a href="..&#x2F;classes/GalleryModelPrimaryKeyIndex.html">GalleryModelPrimaryKeyIndex</a></li>
            
                <li><a href="..&#x2F;classes/GalleryModelSimpleUndo.html">GalleryModelSimpleUndo</a></li>
            
                <li><a href="..&#x2F;classes/GalleryModelSortedMultiRecord.html">GalleryModelSortedMultiRecord</a></li>
            
                <li><a href="..&#x2F;classes/IButton.html">IButton</a></li>
            
                <li><a href="..&#x2F;classes/MakeNode.html">MakeNode</a></li>
            
                <li><a href="..&#x2F;classes/Node.html">Node</a></li>
            
                <li><a href="..&#x2F;classes/Spinner.html">Spinner</a></li>
            
                <li><a href="..&#x2F;classes/StdMod.html">StdMod</a></li>
            
                <li><a href="..&#x2F;classes/TimeSpinner.html">TimeSpinner</a></li>
            
                <li><a href="..&#x2F;classes/Y.Timeline.html">Y.Timeline</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/gallery-button-plugin.html">gallery-button-plugin</a></li>
            
                <li><a href="..&#x2F;modules/gallery-flyweight-tree.html">gallery-flyweight-tree</a></li>
            
                <li><a href="..&#x2F;modules/gallery-fwt-treeview.html">gallery-fwt-treeview</a></li>
            
                <li><a href="..&#x2F;modules/gallery-makenode.html">gallery-makenode</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-accordion.html">gallery-md-accordion</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-button.html">gallery-md-button</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-button-group.html">gallery-md-button-group</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-ibutton.html">gallery-md-ibutton</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-model.html">gallery-md-model</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-spinner.html">gallery-md-spinner</a></li>
            
                <li><a href="..&#x2F;modules/gallery-md-timespinner.html">gallery-md-timespinner</a></li>
            
                <li><a href="..&#x2F;modules/gallery-stdmod.html">gallery-stdmod</a></li>
            
                <li><a href="..&#x2F;modules/timeline.html">timeline</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src&#x2F;gallery-md-model&#x2F;js&#x2F;multi-record.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * Allows GalleryModel to handle a set of records using the Flyweight pattern.
 * It exposes one record at a time from a shelf of records.
 * Exposed records can be selected by setting the {{#crossLink &quot;GalleryModel&#x2F;index:attribute&quot;}}{{&#x2F;crossLink}} attribute.
 * @class GalleryModelMultiRecord
 *&#x2F;

MR = function () {};

MR.prototype = {
    &#x2F;**
     * Added this property to have &#x60;ModelSync.REST getURL()&#x60; return the proper URL.
     * @property _isYUIModelList
     * @type Boolean
     * @value true
     * @private
     *&#x2F;
    _isYUIModelList: true,
    initializer: function () {
        this._shelves = [];
        this._currentIndex = 0;
        this._addPreserve(&#x27;_values&#x27;,&#x27;_loadedValues&#x27;,&#x27;_isNew&#x27;,&#x27;_isModified&#x27;);
    },
    &#x2F;**
     * Sets the initial values if any were provided to the constructor.
     * It is only ever called after the initialization of this class and all its extensions
     * and only if the arguments to the constructor had a &#x60;values&#x60; attribute.
     * It overrides the {{#crossLink &quot;GalleryModel&#x2F;_setInitialValues&quot;}}{{&#x2F;crossLink}}
     * so as to handle arrays.
     * @method _setInitialValues
     * @param ev {EventFacade} in particular:
     * @param ev.cfg.values {Object} values to be set
     * @private
     *&#x2F;
    _setInitialValues: function (ev) {
        this.add(ev.cfg.values);
    },

    &#x2F;**
     * Index of the shelf for the record being exposed.
     * Use {{#crossLink &quot;GalleryModel&#x2F;index:attribute&quot;}}{{&#x2F;crossLink}} attribute to check&#x2F;set the index value.
     * @property _currentIndex
     * @type integer
     * @default 0
     * @private
     *&#x2F;
    _currentIndex: 0,
    &#x2F;**
     * Storage for the records when not exposed.
     * @property _shelves
     * @type Array
     * @private
     *&#x2F;
    _shelves: null,
    &#x2F;**
     * Saves the exposed record into the shelves at the position specified or given by
     * {{#crossLink &quot;GalleryModelMultiRecord&#x2F;_currentIndex&quot;}}{{&#x2F;crossLink}}
     * @method _shelve
     * @param [index=this._currentIndex] {Integer} Position to shelve it in
     * @private
     *&#x2F;
    _shelve: function(index) {
        if (index === undefined) {
            index = this._currentIndex;
        }
        var self = this,
            current = {};
        YArray.each(self._preserve, function (name) {
            current[name] = self[name];
        });
        self._shelves[index] = current;

    },
    &#x2F;**
     * Retrives and exposes the record from the shelf at the position specified or given by
     * {{#crossLink &quot;GalleryModelMultiRecord&#x2F;_currentIndex&quot;}}{{&#x2F;crossLink}}
     * @method _fetch
     * @param [index=this._currentIndex] {Integer} Position to fetch it from.
     * @private
     *&#x2F;
    _fetch: function (index) {
        if (index === undefined) {
            index = this._currentIndex;
        } else {
            this._currentIndex = index;
        }
        var self = this,
            current = self._shelves[index];

        if (Lang.isUndefined(current)) {
            this._initNew();
        } else {
            YArray.each(self._preserve, function (name) {
                self[name] = current[name];
            });
        }

    },
    &#x2F;**
     * Adds the names of properties that are to be preserved in the shelf when moving,
     * and taken out of the shelf when fetching.
     * @method _addPreserve
     * @param name* {String} any number of names or array of names of properties to be preserved.
     * @protected
     *&#x2F;
    _addPreserve: function () {
        this._preserve = (this._preserve || []).concat(Array.prototype.slice.call(arguments));
    },

    &#x2F;**
     * Initializes an exposed record
     * @method _initNew
     * @private
     *&#x2F;
    _initNew: function () {
        this._values = {};
        this._loadedValues = {};
        this._isNew = true;
        this._isModified = false;
    },
    &#x2F;**
     * Adds a new record at the index position given or at the end.
     * The new record becomes the current.
     * @method add
     * @param values {Object|Array} set of values to set.
     * If it is an array, it will call itself for each of the items in it.
     * @param [index] {Integer} position to add the values at or at the end if not provided.
     * @chainable
     *&#x2F;
    add: function(values, index) {
        var self = this;
        if (Lang.isArray(values)) {
            YArray.each(values, function (value, i) {
                self.add(value, (index?index + i:undefined));
            });
            return self;
        }
        if (self.get(IS_MODIFIED) || !self.get(IS_NEW)) {
            self._shelve();
        }
        if (index === undefined) {
            index = self._shelves.length;
        }
        self._shelves.splice(index, 0, {});
        self._currentIndex = index;
        self._initNew();
        self.setValues(values, ADD);
        return self;
    },
    &#x2F;**
     * Executes the given function for each record in the set.
     * The function will run in the scope of the model so it can use
     * &#x60;this.{{#crossLink &quot;GalleryModel&#x2F;getValue&quot;}}{{&#x2F;crossLink}}()&#x60;
     * or any such method to access the values of the current record.
     * Returning exactly &#x60;false&#x60; from the function spares shelving the record.
     * If the callback function does not modify the record,
     * returning &#x60;false&#x60; will improve performance.
     * @method each
     * @param fn {function} function to execute, it will be provided with:
     * @param fn.index {integer} index of the record exposed
     * @chainable
     *&#x2F;
    each: function(fn) {
        var self = this;
        self._shelve();
        YArray.each(self._shelves, function (shelf, index) {
            self._currentIndex = index;
            self._fetch(index);
            if (fn.call(self, index) !== false) {
                self._shelve(index);
            }
        });
        return self;
    },
    &#x2F;**
     * Executes the given function for each record in the set.
     * The function will run in the scope of the model so it can use
     * &#x60;this.{{#crossLink &quot;GalleryModel&#x2F;getValue&quot;}}{{&#x2F;crossLink}}&#x60;
     * or any such method to access the values of the current record.
     * It is faster than using {{#crossLink &quot;GalleryModelMultiRecord&#x2F;each&quot;}}{{&#x2F;crossLink}}
     * and then checking the {{#crossLink &quot;GalleryModel&#x2F;isModified:attribute&quot;}}{{&#x2F;crossLink}} attribute
     * Returning exactly &#x60;false&#x60; from the function spares shelving the record.
     * If the callback function does not modify the record,
     * returning &#x60;false&#x60; will improve performance.
     * @method eachModified
     * @param fn {function} function to execute, it will be provided with:
     * @param fn.index {integer} index of the record exposed
     * @chainable
     *&#x2F;
    eachModified:function(fn) {
        var self = this;
        self._shelve();
        YArray.each(self._shelves,  function (shelf, index) {
            if (self._shelves[index][IS_MODIFIED]) {
                self._currentIndex = index;
                self._fetch(index);
                if (fn.call(self, index) !== false) {
                    self._shelve(index);
                }
            }
        });
        return self;
    },
    &#x2F;**
     * Calls {{#crossLink &quot;GalleryModel&#x2F;save&quot;}}{{&#x2F;crossLink}} on each record modified.
     * This is not the best saving strategy for saving batches of records,
     * but it is the easiest and safest.  Implementors are encouraged to
     * design their own.
     * @method saveAllModified
     * @chainable
     *&#x2F;
    saveAllModified: function () {
        this.eachModified(this.save);
        return this;
    },
    &#x2F;**
     * This is a documentation entry only, this method does not define &#x60;load&#x60;.
     * This extension redefines the default action for the {{#crossLink &quot;GalleryModel&#x2F;loaded:event&quot;}}{{&#x2F;crossLink}} event so
     * that if a load returns an array of records, they will be added to the shelves.
     * Existing records are kept, call {{#crossLink &quot;GalleryModelMultiRecord&#x2F;empty&quot;}}{{&#x2F;crossLink}} if they should be discarded.
     * See method {{#crossLink &quot;GalleryModel&#x2F;load&quot;}}{{&#x2F;crossLink}} of {{#crossLink &quot;GalleryModel&quot;}}{{&#x2F;crossLink}} for further info.
     * @method load
     *&#x2F;
    &#x2F;**
     * Default action for the loaded event, checks if the parsed response is an array
     * and saves it into the shelves, otherwise it calls the default loader for single records.
     * @method _defDataLoaded
     * @param ev {EventFacade} facade produced by load.
     * @private
     *&#x2F;
    _defDataLoaded: function (ev) {
        var self = this,
            shelves = self._shelves;
        if (Lang.isArray(ev.parsed)) {
            if (shelves.length &amp;&amp; (self.get(IS_MODIFIED) || !self.get(IS_NEW))) {
                self._shelve();
            }
            YArray.each(ev.parsed, function (values) {
                shelves.push({
                    _values: values,
                    _loadedValues: Y.clone(values),
                    isNew: false,
                    isModified:false
                });
            });
            self._fetch();
            if (self._sort) {
                self._sort();
            }
            ev.callback.call(self,null, ev.response);
        } else {
            Y.GalleryModel.prototype._defDataLoaded.apply(self, arguments);
        }

    },
    &#x2F;**
     * Returns the number of records stored, skipping over empty slots.
     * @method size
     * @return {Integer} number of records in the shelves
     *&#x2F;
    size: function() {
        var count = 0;
        YArray.each(this._shelves, function () {
            count +=1;
        });
        return count;
    },
    &#x2F;**
     * Empties the shelves of any records as well as the exposed record
     * @method empty
     * @chainable
     *&#x2F;
    empty: function () {
        this._shelves = [];
        this._currentIndex = 0;
        this.reset();
        return this;
    },
    &#x2F;**
     * Setter for the {{#crossLink &quot;GalleryModelMultiRecord&#x2F;index:attribute&quot;}}{{&#x2F;crossLink}} attribute.
     * Validates and copies the current index value into {{#crossLink &quot;GalleryModel&#x2F;_currentIndex&quot;}}{{&#x2F;crossLink}}.
     * It shelves the current record and fetches the requested one.
     * @method _indexSetter
     * @param value {integer} new value for the index
     * @return {integer|INVALID_VALUE} new value for the index or INVALID_VALUE if invalid.
     * @private
     *&#x2F;
    _indexSetter: function (value) {
        if (Lang.isNumber(value) &amp;&amp; value &gt;= 0 &amp;&amp; value &lt; this._shelves.length) {
            this._shelve(this._currentIndex);
            this._currentIndex = value = parseInt(value,10);
            this._fetch(value);
            return value;
        }
        return Y.Attribute.INVALID_VALUE;
    },
    &#x2F;**
     * Getter for the {{#crossLink &quot;GalleryModelMultiRecord&#x2F;index:attribute&quot;}}{{&#x2F;crossLink}} attribute
     * Returns the value from {{#crossLink &quot;GalleryModelMultiRecord&#x2F;_currentIndex&quot;}}{{&#x2F;crossLink}}
     * @method _indexGetter
     * @return {integer} value of the index
     * @private
     *&#x2F;
    _indexGetter: function () {
        return this._currentIndex;
    },
    &#x2F;**
     * Getter for the {{#crossLink &quot;GalleryModel&#x2F;isNew:attribute&quot;}}{{&#x2F;crossLink}} attribute used only for GalleryModelMultiRecord
     * so that it is read from the shelf and not from the actual attribute,
     * which is expensive to shelve
     * @method _isNewGetter
     * @param value {Boolean} value stored in the attribute, it is ignored.
     * @param name {String} name of the attribute.
     *		If it contains a dot, the original getter is called.
     * @return {Boolean} state of the attribute
     * @private
     *&#x2F;
    _isNewGetter: function (value, name) {
        if (name.split(DOT).length &gt; 1) {
            return Y.GalleryModel.prototype._isNewGetter.apply(this, arguments);
        }
        return this._isNew;

    },
    &#x2F;**
     * Setter for the {{#crossLink &quot;GalleryModel&#x2F;isNew:attribute&quot;}}{{&#x2F;crossLink}} attribute used only for GalleryModelMultiRecord
     * so that it is written into the shelf and not into the actual attribute,
     * which is expensive to shelve
     * @method _isNewSetter
     * @param value {Boolean} value stored in the attribute.
     * @return {Boolean} the same value as received.
     * @private
     *&#x2F;
    _isNewSetter: function (value) {
        return (this._isNew = value);
    },
    &#x2F;**
     * Getter for the {{#crossLink &quot;GalleryModel&#x2F;isModified:attribute&quot;}}{{&#x2F;crossLink}} attribute used only for GalleryModelMultiRecord
     * so that it is read from the shelf and not from the actual attribute,
     * which is expensive to shelve
     * @method _isModifiedGetter
     * @param value {Boolean} value stored in the attribute, it is ignored.
     * @param name {String} name of the attribute.
     *		If it contains a dot, the original getter is called.
     * @return {Boolean} state of the attribute
     * @private
     *&#x2F;
    _isModifiedGetter:  function (value, name) {
        if (name.split(DOT).length &gt; 1) {
            return Y.GalleryModel.prototype._isModifiedGetter.apply(this, arguments);
        }
        return this._isModified;

    },
    &#x2F;**
     * Setter for the {{#crossLink &quot;GalleryModel&#x2F;isModified:attribute&quot;}}{{&#x2F;crossLink}} attribute used only for GalleryModelMultiRecord
     * so that it is written into the shelf and not into the actual attribute,
     * which is expensive to shelve
     * @method _isModifiedSetter
     * @param value {Boolean} value stored in the attribute.
     * @return {Boolean} the same value as received.
     * @private
     *&#x2F;
    _isModifiedSetter:  function (value) {
        return (this._isModified = value);
    }


};

MR.ATTRS = {
    &#x2F;**
     * Index of the record exposed.
     * @attribute index
     * @type Integer
     * @default 0
     *&#x2F;
    index: {
        value: 0,
        setter:&#x27;_indexSetter&#x27;,
        getter:&#x27;_indexGetter&#x27;
    },
    &#x2F;**
     * Merges the new setter into the existing {{#crossLink &quot;GalleryModel&#x2F;isNew:attribute&quot;}}{{&#x2F;crossLink}} attribute
     * @attribute isNew
     *&#x2F;
    isNew: {
        setter:&#x27;_isNewSetter&#x27;
    },
    &#x2F;**
     * Merges the new setter into the existing {{#crossLink &quot;GalleryModel&#x2F;isModified:attribute&quot;}}{{&#x2F;crossLink}} attribute.
     * @attribute isModified
     *&#x2F;
    isModified: {
        setter: &#x27;_isModifiedSetter&#x27;
    }
};

Y.GalleryModelMultiRecord = MR;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
